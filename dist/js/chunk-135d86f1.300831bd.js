(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-135d86f1"],{"1fb3":function(e,t,a){},"2fa4":function(e,t,a){"use strict";a("20f6");var s=a("80d2");t["a"]=Object(s["i"])("spacer","div","v-spacer")},"4fe7":function(e,t,a){"use strict";var s=a("1fb3"),r=a.n(s);r.a},a523:function(e,t,a){"use strict";a("20f6"),a("4b85");var s=a("e8f2"),r=a("d9f7");t["a"]=Object(s["a"])("container").extend({name:"v-container",functional:!0,props:{id:String,tag:{type:String,default:"div"},fluid:{type:Boolean,default:!1}},render(e,{props:t,data:a,children:s}){let i;const{attrs:l}=a;return l&&(a.attrs={},i=Object.keys(l).filter(e=>{if("slot"===e)return!1;const t=l[e];return e.startsWith("data-")?(a.attrs[e]=t,!1):t||"string"===typeof t})),t.id&&(a.domProps=a.domProps||{},a.domProps.id=t.id),e(t.tag,Object(r["a"])(a,{staticClass:"container",class:Array({"container--fluid":t.fluid}).concat(i||[])}),s)}})},ca28:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",[a("v-container",[a("v-card",{staticClass:"mx-auto auth"},[a("h1",{attrs:{color:"primary"}},[e._v(e._s(e.parser.title))]),e._l(e.errors,(function(t,s){return a("div",{key:"err"+s,staticClass:"err"},[e._v(e._s(t))])})),a("v-dialog",{attrs:{"max-width":"290"},model:{value:e.success_parse,callback:function(t){e.success_parse=t},expression:"success_parse"}},[a("v-card",[a("v-card-title",{staticClass:"headline"},[e._v("Загрузка ")]),a("v-card-text",[e._v("Ваш файл "+e._s(e.orig_name)+" был успешно загружен на сервер!")]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"primary"},on:{click:function(t){e.success_parse=!1}}},[e._v("\n                      ОК\n                    ")])],1)],1)],1),a("form",{attrs:{id:"parse_xls_form"}},[a("div",[a("input",{attrs:{type:"file",id:"parse_xls_file"},on:{change:e.change}})]),e.src?a("div",{staticStyle:{"margin-top":"10px"}},[a("a",{attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.cancel(t)}}},[e._v("отменить")])]):e._e()]),e.preload_data.length&&e.loaded_filename?a("div",{staticClass:"comment"},[e.all_fields_selected?e._e():a("div",{staticClass:"not_selected"},[e._v("\n                  Файл загружен на сервер, для того, чтобы продолжить -- выберите соответствие колонок\n                ")]),a("table",{staticClass:"select_cols"},e._l(e.parser.fields,(function(t,s){return a("tr",{key:"field"+s},[a("td",[e._v(e._s(t.description))]),a("td",[a("select",{directives:[{name:"model",rawName:"v-model",value:t.selected,expression:"f.selected"}],on:{change:function(a){var s=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(t,"selected",a.target.multiple?s:s[0])}}},[a("option",{attrs:{value:"n"}},[e._v("выберите столбец")]),e._l(e.first_header,(function(t){return a("option",{key:t.v,domProps:{value:t.v}},[e._v(e._s(t.d))])}))],2),e.all_fields_selected?e._e():[t.selected>=0?a("div",{staticClass:"selected"},[e._v("выбрано")]):a("div",{staticClass:"not_selected"},[e._v("не выбрано")])]],2)])})),0),e.all_fields_selected?a("div",{staticStyle:{color:"green","font-weight":"bold"}},[e.data_line_number?a("div",{staticClass:"selected"},[e._v("\n                    Отлично, теперь можно приступить к загрузке файла\n                    "),a("hr"),e.all_fields_selected?a("v-btn",{attrs:{small:"",color:"primary"},on:{click:function(t){return e.load()}}},[e._v("Загрузить")]):e._e()],1):a("div",{staticClass:"not_selected"},[e._v("Вы выбрали все столбцы. Теперь отметьте слева строку, с которой начинаются данные (заголовок не считаем)")])]):e._e()]):a("div",{staticClass:"comment"},[e._v("Вы можете загрузить файл в формате xls или xlsx\n              ")]),e.uploading?a("v-progress-linear",{attrs:{color:"primary",indeterminate:"",rounded:"",height:"6"}}):e._e(),a("hr"),e.preload_data.length&&e.loaded_filename?a("h2",[e._v("Предварительный просмотр:")]):e._e(),a("table",{staticClass:"preload"},e._l(e.preload_data,(function(t,s){return a("tr",{key:"col"+s},[a("td",[0==s?[e._v("данные")]:a("input",{directives:[{name:"model",rawName:"v-model",value:e.data_line_number,expression:"data_line_number"}],attrs:{type:"radio"},domProps:{value:parseInt(s),checked:e._q(e.data_line_number,parseInt(s))},on:{change:function(t){e.data_line_number=parseInt(s)}}})],2),e._l(t,(function(t,s){return a("td",{key:"col"+s},[e._v(e._s(t))])}))],2)})),0)],2)],1)],1)},r=[],i={props:["params"],data:()=>({orig_name:"",src:"",uploading:!1,data_line_number:!1,parser:{},preload_data:[],first_header:[],loaded_filename:"",success_parse:!1,errors:[]}),mounted(){},created(){this.$http.post(BackendBase+"/parser-excel/"+this.params.config,{action:"init"}).then(e=>{let t=e.data;if(t.success){for(let e of t.parser.fields)e.selected="-1";this.parser=t.parser}}).catch(e=>{this.errors=[e]})},watch:{success_parse(e){e||this.cancel()}},methods:{change(){this.uploading=!0;let e=document.getElementById("parse_xls_file").files[0],t=new FileReader;t.readAsDataURL(e),t.onload=t=>{this.orig_name=e.name,this.src=t.target.result,this.preload()}},preload(){this.$http.post(BackendBase+"/parser-excel/"+this.params.config,{action:"preload",src:this.src,orig_name:this.orig_name}).then(e=>{let t=e.data;this.uploading=!1,t.success&&(this.preload_data=t.data,this.loaded_filename=t.loaded_filename,this.calc_first_header()),this.errors=t.errors}).catch(e=>{this.uploading=!1,this.errors=[e]})},cancel(){this.src="",this.orig_name="",this.data_line_number=!1,this.preload_data=[];let e=this.loaded_filename;if(this.remove_tmp(e),this.parser.fields)for(let t of this.parser.fields)t.selected=-1;document.getElementById("parse_xls_form").reset()},remove_tmp(e){e&&this.$http.post(BackendBase+"/parser-excel/"+this.params.config,{action:"remove_tmp_file",tmp_file:e}).then(e=>{e.data})},load(){this.uploading=!0,this.$http.post(BackendBase+"/parser-excel/"+this.params.config,{action:"load",loaded_filename:this.loaded_filename,data_line_number:this.data_line_number,fields:this.parser.fields}).then(e=>{let t=e.data;this.uploading=!1,t.success&&(this.success_parse=!0),this.errors=t.errors}).catch(e=>{this.uploading=!1,this.errors=[e]})},calc_first_header(){let e=[];if(!this.preload_data||!this.preload_data.length)return;let t=0;for(let a of this.preload_data[0])e.push({v:t,d:a}),t++;this.first_header=e}},computed:{all_fields_selected(){if(!this.parser.fields)return!1;for(let e of this.parser.fields)if(e.selected<0)return!1;return!0}}},l=i,n=(a("4fe7"),a("2877")),d=a("6544"),c=a.n(d),o=a("7496"),_=a("8336"),p=a("b0af"),u=a("99d9"),f=a("a523"),h=a("169a"),m=a("8e36"),v=a("2fa4"),g=Object(n["a"])(l,s,r,!1,null,null,null);t["default"]=g.exports;c()(g,{VApp:o["a"],VBtn:_["a"],VCard:p["a"],VCardActions:u["a"],VCardText:u["b"],VCardTitle:u["c"],VContainer:f["a"],VDialog:h["a"],VProgressLinear:m["a"],VSpacer:v["a"]})}}]);
//# sourceMappingURL=chunk-135d86f1.300831bd.js.map