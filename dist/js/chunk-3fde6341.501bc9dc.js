(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3fde6341"],{"23a7":function(e,t,i){"use strict";i("5803");var n=i("2677"),o=i("cc20"),s=i("80d2"),r=i("d9bd"),a=i("d9f7");t["a"]=n["a"].extend({name:"v-file-input",model:{prop:"value",event:"change"},props:{chips:Boolean,clearable:{type:Boolean,default:!0},counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,placeholder:String,prependIcon:{type:String,default:"$file"},readonly:{type:Boolean,default:!1},showSize:{type:[Boolean,Number],default:!1,validator:e=>{return"boolean"===typeof e||[1e3,1024].includes(e)}},smallChips:Boolean,truncateLength:{type:[Number,String],default:22},type:{type:String,default:"file"},value:{default:void 0,validator:e=>{return Object(s["B"])(e).every(e=>null!=e&&"object"===typeof e)}}},computed:{classes(){return{...n["a"].options.computed.classes.call(this),"v-file-input":!0}},computedCounterValue(){const e=this.multiple&&this.lazyValue?this.lazyValue.length:this.lazyValue instanceof File?1:0;if(!this.showSize)return this.$vuetify.lang.t(this.counterString,e);const t=this.internalArrayValue.reduce((e,{size:t=0})=>{return e+t},0);return this.$vuetify.lang.t(this.counterSizeString,e,Object(s["s"])(t,1024===this.base))},internalArrayValue(){return Object(s["B"])(this.internalValue)},internalValue:{get(){return this.lazyValue},set(e){this.lazyValue=e,this.$emit("change",this.lazyValue)}},isDirty(){return this.internalArrayValue.length>0},isLabelActive(){return this.isDirty},text(){return this.isDirty||!this.isFocused&&this.hasLabel?this.internalArrayValue.map(e=>{const{name:t="",size:i=0}=e,n=this.truncateText(t);return this.showSize?`${n} (${Object(s["s"])(i,1024===this.base)})`:n}):[this.placeholder]},base(){return"boolean"!==typeof this.showSize?this.showSize:void 0},hasChips(){return this.chips||this.smallChips}},watch:{readonly:{handler(e){!0===e&&Object(r["b"])("readonly is not supported on <v-file-input>",this)},immediate:!0},value(e){const t=this.multiple?e:e?[e]:[];Object(s["j"])(t,this.$refs.input.files)||(this.$refs.input.value="")}},methods:{clearableCallback(){this.internalValue=this.multiple?[]:null,this.$refs.input.value=""},genChips(){return this.isDirty?this.text.map((e,t)=>this.$createElement(o["a"],{props:{small:this.smallChips},on:{"click:close":()=>{const e=this.internalValue;e.splice(t,1),this.internalValue=e}}},[e])):[]},genControl(){const e=n["a"].options.methods.genControl.call(this);return this.hideInput&&(e.data.style=Object(a["c"])(e.data.style,{display:"none"})),e},genInput(){const e=n["a"].options.methods.genInput.call(this);return e.data.attrs.multiple=this.multiple,delete e.data.domProps.value,delete e.data.on.input,e.data.on.change=this.onInput,[this.genSelections(),e]},genPrependSlot(){if(!this.prependIcon)return null;const e=this.genIcon("prepend",()=>{this.$refs.input.click()});return this.genSlot("prepend","outer",[e])},genSelectionText(){const e=this.text.length;return e<2?this.text:this.showSize&&!this.counter?[this.computedCounterValue]:[this.$vuetify.lang.t(this.counterString,e)]},genSelections(){const e=[];return this.isDirty&&this.$scopedSlots.selection?this.internalArrayValue.forEach((t,i)=>{this.$scopedSlots.selection&&e.push(this.$scopedSlots.selection({text:this.text[i],file:t,index:i}))}):e.push(this.hasChips&&this.isDirty?this.genChips():this.genSelectionText()),this.$createElement("div",{staticClass:"v-file-input__text",class:{"v-file-input__text--placeholder":this.placeholder&&!this.isDirty,"v-file-input__text--chips":this.hasChips&&!this.$scopedSlots.selection}},e)},genTextFieldSlot(){const e=n["a"].options.methods.genTextFieldSlot.call(this);return e.data.on={...e.data.on||{},click:()=>this.$refs.input.click()},e},onInput(e){const t=[...e.target.files||[]];this.internalValue=this.multiple?t:t[0],this.initialValue=this.internalValue},onKeyDown(e){this.$emit("keydown",e)},truncateText(e){if(e.length<Number(this.truncateLength))return e;const t=Math.floor((Number(this.truncateLength)-1)/2);return`${e.slice(0,t)}…${e.slice(e.length-t)}`}}})},2677:function(e,t,i){"use strict";var n=i("8654");t["a"]=n["a"]},5803:function(e,t,i){},"7a0f":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e.field.read_only?[e.field.begin_value?i("a",{attrs:{href:e.download_link,download:""}},[e._v("скачать")]):e._e()]:[i("v-file-input",{attrs:{accept:e.field.accept,id:e.field.name+"_attach",label:e.field.description,rounded:e.$theme.rounded,"hide-details":""},on:{change:e.run_cropper,"click:clear":e.clear}}),e.begin_value&&!e.imgSrc?i("div",{staticClass:"show_loaded"},[e.show_loaded?e._e():i("div",[e.is_img?i("v-icon",{staticClass:"show",attrs:{"x-small":""},on:{click:function(t){t.preventDefault(),e.show_loaded=!0}}},[e._v("fa-eye")]):e._e(),i("a",{attrs:{href:e.img_path,download:""}},[e._v("скачать")]),e._v(" | \n          "),e.field.required?e._e():i("a",{attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.remove()}}},[e._v("удалить")])],1),e.show_loaded?[i("v-icon",{staticClass:"not_show",attrs:{"x-small":""},on:{click:function(t){t.preventDefault(),e.show_loaded=!1}}},[e._v("fa-eye-slash")]),e.field.crops&&e.field.resize&&e.field.resize.length?i("a",{attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.start_crop_already_loaded(t)}}},[e._v("обрезать фото заново")]):e._e()]:e._e(),e.show_loaded?[e.field.resize&&e.field.resize.lenght?i("v-layout",{attrs:{row:"",wrap:""}},e._l(e.field.resize,(function(t,n){return i("v-flex",{key:"resize"+e.field.name+"_"+n,attrs:{"pl-3":"",lg2:"",md4:"",xs12:""}},[i("v-card",{staticClass:"img_show"},[i("a",{attrs:{href:t.loaded,target:"_blank"}},[i("img",{staticStyle:{"max-height":"100%",margin:"20px"},attrs:{src:t.loaded}})])])],1)})),1):e.is_img?i("div",{staticClass:"img_show"},[i("img",{staticStyle:{"max-width":"100%"},attrs:{src:e.img_path}})]):i("a",{attrs:{href:e.download_link}},[e._v("скачать")])]:e._e()],2):e._e(),e.field.crops&&e.imgSrc?[e.all_accept?i("div",{staticClass:"accepted"},[i("b",[e._v("Все фото подтверждены")])]):i("div",{staticClass:"not_accepted"},[i("b",[e._v("Не все изображения подтверждены")]),e._e(),e._v(" \n            "),e.begin_value?i("a",{attrs:{href:""},on:{click:function(t){t.preventDefault(),e.imgSrc="",e.field_error_check()}}},[e._v("отмена")]):e._e()]),i("v-layout",{attrs:{row:"",wrap:""}},e._l(e.crops,(function(t,n){return i("v-flex",{key:"crop"+n,attrs:{"pl-3":"",lg4:"",md4:"",xs12:""}},[i("v-card",{staticClass:"card_cropper"},[i("div",[e._v(" "+e._s(t.description)+" \n                            "),e.all_accept?e._e():[2==e.crops[n].accept?i("span",{staticClass:"accepted"},[e._v("подтверждено")]):1==e.crops[n].accept?i("span",{staticClass:"process_accepted"},[e._v("подтверждается")]):i("span",{staticClass:"not_ac"},[i("a",{attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.crop(n)}}},[e._v("подтвердить")])])]],2),i("Cropper",{ref:"c"+n,refInFor:!0,attrs:{classname:"cropper",src:e.imgSrc,"stencil-props":e.stencil_props(t)},on:{change:function(t){return e.change(n)}}})],1)],1)})),1)]:e._e()],e._e(),i("div",{staticClass:"err"},[e._v(e._s(e.err_str))])],2)},o=[],s=i("2b0e");function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var i,n=0;n<t.length;n++)i=t[n],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}function c(e,t,i){return t&&h(e.prototype,t),i&&h(e,i),e}function l(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function u(e){for(var t=1;t<arguments.length;t++){var i=null==arguments[t]?{}:arguments[t],n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter((function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable})))),n.forEach((function(t){l(e,t,i[t])}))}return e}function d(e){return p(e)||m(e)||f()}function p(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}}function m(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function f(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function g(e,t){return t={exports:{}},e(t,t.exports),t.exports}var v=g((function(e){(function(){function t(){for(var e,n=[],o=0;o<arguments.length;o++)if(e=arguments[o],e){var s=typeof e;if("string"===s||"number"===s)n.push(e);else if(Array.isArray(e)&&e.length){var r=t.apply(null,e);r&&n.push(r)}else if("object"===s)for(var a in e)i.call(e,a)&&e[a]&&n.push(a)}return n.join(" ")}var i={}.hasOwnProperty;e.exports?(t.default=t,e.exports=t):window.classNames=t})()})),w=function(e){return function(t,i){if(!t)return e;var n;"string"==typeof t?n=t:i=t;var o=e;return n&&(o+="__"+n),o+(i?Object.keys(i).reduce((function(e,t){var n=i[t];return n&&(e+=" "+("boolean"==typeof n?o+"--"+t:o+"--"+t+"_"+n)),e}),""):"")}};function b(e,t,i){function n(){var c=Date.now()-a;c<t&&0<=c?o=setTimeout(n,t-c):(o=null,!i&&(h=e.apply(r,s),r=s=null))}var o,s,r,a,h;null==t&&(t=100);var c=function(){r=this,s=arguments,a=Date.now();var c=i&&!o;return o||(o=setTimeout(n,t)),c&&(h=e.apply(r,s),r=s=null),h};return c.clear=function(){o&&(clearTimeout(o),o=null)},c.flush=function(){o&&(h=e.apply(r,s),r=s=null,clearTimeout(o),o=null)},c}b.debounce=b;var y=b;function x(e,t){var i,n;return e&&t?(i="".concat(e).concat(t[0].toUpperCase()).concat(t.slice(1)),n="".concat(e,"-").concat(t)):(i=e||t,n=e||t),{name:i,classname:n}}function _(e){return/^data:/.test(e)||/^blob:/.test(e)}function S(e){if(_(e))return!1;var t=window.location,i=/(\w+:)?(?:\/\/)([\w.-]+)?(?::(\d+))?\/?/,n=i.exec(e)||[],o={protocol:n[1]||"",host:n[2]||"",port:n[3]||""},s=function(e){return{"http:":80,"https:":443}[e]},r=function(e){return e.port||s(e.protocol||t.protocol)};return(o.protocol||o.host||o.port)&&!(o.protocol&&o.protocol==t.protocol&&o.host&&o.host==t.host&&o.host&&r(o)==r(t))}function z(e){return"undefined"==typeof e}function C(e){return"object"===r(e)&&null!==e}function E(e){var t="timestamp=".concat((new Date).getTime());return e+(-1===e.indexOf("?")?"?":"&")+t}function T(e,t){var i=Math.pow;return Math.sqrt(i(e.x-t.x,2)+i(e.y-t.y,2))}function M(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=u({enabled:!!e},t);return C(e)&&(i=u({},i,e)),i}function R(e){var t=Number.isNaN,i=+e;return t(i)?e:i}var W=function e(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};a(this,e),this.nativeEvent=t,this.move=i,this.scale=n,this.params=o},$=function e(t,i){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};a(this,e),this.nativeEvent=t,this.directions=i,this.params=n},k=function e(t,i){a(this,e),this.nativeEvent=t,this.directions=i},D=function(){function e(t,i,n,o,s){a(this,e),this.nativeEvent=t,this.position=n,this.previousPosition=o,this.element=i,this.anchor=s}return c(e,[{key:"shift",value:function(){var e=this.element,t=this.anchor,i=this.position,n=e.getBoundingClientRect(),o=n.left,s=n.top;return{left:i.left-o-t.left,top:i.top-s-t.top}}}]),e}(),A={beforeMount:function(){window.addEventListener("mouseup",this.onMouseUp,{passive:!1}),window.addEventListener("mousemove",this.onMouseMove,{passive:!1}),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd,{passive:!1})},beforeDestroy:function(){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},mounted:function(){if(!this.$refs.draggable)throw new Error('You should add ref "draggable" to your root element to use draggable mixin');this.touches=[],this.draggingAnchor=[],this.hovered=!1},methods:{onMouseOver:function(){this.hovered||(this.hovered=!0,this.$emit("enter"))},onMouseLeave:function(){this.hovered&&(this.hovered=!1,this.$emit("leave"))},onTouchStart:function(e){e.cancelable&&!this.disabled&&1===e.touches.length&&(this.touches=d(e.touches),!this.hovered&&this.$emit("enter"),e.touches.length&&this.initAnchor(this.touches.reduce((function(t,i){return{clientX:t.clientX+i.clientX/e.touches.length,clientY:t.clientY+i.clientY/e.touches.length}}),{clientX:0,clientY:0})),e.preventDefault&&e.preventDefault(),e.stopPropagation())},onTouchEnd:function(){this.processEnd()},onTouchMove:function(e){this.touches.length&&(this.processMove(e,e.touches),e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation())},onMouseDown:function(e){if(!this.disabled){var t={fake:!0,clientX:e.clientX,clientY:e.clientY};this.touches=[t],this.initAnchor(t),e.stopPropagation()}},onMouseMove:function(e){this.touches.length&&(this.processMove(e,[{fake:!0,clientX:e.clientX,clientY:e.clientY}]),e.preventDefault&&e.preventDefault())},onMouseUp:function(){this.touches=[]},initAnchor:function(e){var t=this.$refs.draggable,i=t.getBoundingClientRect(),n=i.left,o=i.right,s=i.bottom,r=i.top;this.anchor={left:e.clientX-n,top:e.clientY-r,bottom:s-e.clientY,right:o-e.clientX}},processMove:function(e,t){var i=d(t);if(this.touches.length){if(1===this.touches.length&&1===i.length){var n=this.$refs.draggable;this.$emit("drag",new D(e,n,{left:i[0].clientX,top:i[0].clientY},{left:this.touches[0].clientX,top:this.touches[0].clientY},this.anchor))}this.touches=i}},processEnd:function(){this.touches=[],this.hovered&&(this.$emit("leave"),this.hovered=!1)}}},H={name:"DraggableElement",mixins:[A],props:{classname:{type:String}}};function O(e,t,i,n,o,s,r,a,h,c){"boolean"!=typeof r&&(h=a,a=r,r=!1);var l,u="function"==typeof i?i.options:i;if(e&&e.render&&(u.render=e.render,u.staticRenderFns=e.staticRenderFns,u._compiled=!0,o&&(u.functional=!0)),n&&(u._scopeId=n),s?(l=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,h(e)),e&&e._registeredComponents&&e._registeredComponents.add(s)},u._ssrRegister=l):t&&(l=r?function(){t.call(this,c(this.$root.$options.shadowRoot))}:function(e){t.call(this,a(e))}),l)if(u.functional){var d=u.render;u.render=function(e,t){return l.call(t),d(e,t)}}else{var p=u.beforeCreate;u.beforeCreate=p?[].concat(p,l):[l]}return i}var B=O,L=H,j=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"draggable",class:e.classname,on:{touchstart:e.onTouchStart,mousedown:e.onMouseDown,mouseover:e.onMouseOver,mouseleave:e.onMouseLeave}},[e._t("default")],2)},P=[],I=void 0,X=void 0,Y=void 0,N=!1,F=B({render:j,staticRenderFns:P},I,L,X,N,Y,void 0,void 0),U=w("vue-handler-wrapper"),V={name:"HandlerWrapper",components:{DraggableElement:F},props:{horizontalPosition:{type:String},verticalPosition:{type:String},classname:{type:String},disabled:{type:Boolean,default:!1}},computed:{classnames:function(){var e;if(this.horizontalPosition||this.verticalPosition){var t,i=x(this.horizontalPosition,this.verticalPosition);e=v(this.classname,U((t={},l(t,i.classname,!0),l(t,"disabled",this.disabled),t)))}else e=v(this.classname,U({disabled:this.disabled}));return{default:e,draggable:U("draggable")}}}},q=V,G=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.classnames.default},[i("DraggableElement",{class:e.classnames.draggable,attrs:{disabled:e.disabled},on:{drag:function(t){return e.$emit("drag",t)},leave:function(){return e.$emit("leave")},enter:function(){return e.$emit("enter")}}},[e._t("default")],2)],1)},Z=[],J=void 0,K=void 0,Q=void 0,ee=!1,te=B({render:G,staticRenderFns:Z},J,q,K,ee,Q,void 0,void 0),ie=w("vue-line-wrapper"),ne={name:"LineWrapper",components:{DraggableElement:F},props:{position:{type:String,required:!0},disabled:{type:Boolean,default:!1}},computed:{classname:function(){var e;return ie((e={},l(e,this.position,!0),l(e,"disabled",this.disabled),e))}}},oe=ne,se=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("DraggableElement",{class:e.classname,attrs:{disabled:e.disabled},on:{drag:function(t){return e.$emit("drag",t)},leave:function(){return e.$emit("leave")},enter:function(){return e.$emit("enter")}}},[e._t("default")],2)},re=[],ae=void 0,he=void 0,ce=void 0,le=!1,ue=B({render:se,staticRenderFns:re},ae,oe,he,le,ce,void 0,void 0),de=w("vue-bounding-box"),pe=["east","west",null],me=["south","north",null],fe={name:"BoundingBox",props:{classname:{type:String},handlers:{type:Object,default:function(){return{eastNorth:!0,north:!0,westNorth:!0,west:!0,westSouth:!0,south:!0,eastSouth:!0,east:!0}}},handlerComponent:{type:[Object,String]},handlersClassnames:{type:Object,default:function(){return{}}},lines:{type:Object,default:function(){return{west:!0,north:!0,east:!0,south:!0}}},lineComponent:{type:[Object,String]},linesClassnames:{type:Object,default:function(){return{}}},scalable:{type:Boolean,default:!0}},data:function(){var e=[];return pe.forEach((function(t){me.forEach((function(i){if(t!==i){var n=x(t,i),o=n.name,s=n.classname;e.push({name:o,classname:s,verticalDirection:i,horizontalDirection:t})}}))})),{points:e}},computed:{classnames:function(){var e=this.handlersClassnames,t=this.linesClassnames;return{default:v(de(),this.classname),handlers:e,lines:t}},lineNodes:function(){var e=this,t=[];return this.points.forEach((function(i){i.horizontalDirection&&i.verticalDirection||!e.lines[i.name]||t.push({name:i.name,component:e.lineComponent,classname:v(e.classnames.lines.default,e.classnames.lines[i.name],!e.scalable&&e.classnames.lines.disabled),hoverClassname:e.classnames.lines.hover,verticalDirection:i.verticalDirection,horizontalDirection:i.horizontalDirection,disabled:!e.scalable})})),t},handlerNodes:function(){var e=this,t=[];return this.points.forEach((function(i){e.handlers[i.name]&&t.push({name:i.name,component:e.handlerComponent,classname:v(e.classnames.handlers.default,e.classnames.handlers[i.name]),hoverClassname:e.classnames.handlers.hover,verticalDirection:i.verticalDirection,horizontalDirection:i.horizontalDirection,disabled:!e.scalable})})),t}},beforeMount:function(){window.addEventListener("mouseup",this.onMouseUp,{passive:!1}),window.addEventListener("mousemove",this.onMouseMove,{passive:!1}),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd,{passive:!1})},beforeDestroy:function(){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},mounted:function(){this.touches=[]},methods:{onHandlerDrag:function(e,t,i){var n,o=e.shift(),s=o.left,r=o.top,a={left:0,right:0,top:0,bottom:0};"west"===t?a.left-=s:"east"==t&&(a.right+=s),"north"===i?a.top-=r:"south"==i&&(a.bottom+=r),!i&&t?n="width":i&&!t&&(n="height"),this.scalable&&this.$emit("resize",new $(e.nativeEvent,a,{allowedDirections:{left:"west"===t||!t,right:"east"===t||!t,bottom:"south"===i||!i,top:"north"===i||!i},preserveAspectRatio:e.nativeEvent.shiftKey,respectDirection:n}))}}},ge=fe,ve=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"box",class:e.classnames.default},[e._t("default"),e._v(" "),i("div",e._l(e.lineNodes,(function(t){return i(t.component,{key:t.name,tag:"component",attrs:{classname:t.classname,"hover-classname":t.hoverClassname,position:t.name,disabled:t.disabled},on:{drag:function(i){return e.onHandlerDrag(i,t.horizontalDirection,t.verticalDirection)}}})})),1),e._v(" "),i("div",e._l(e.handlerNodes,(function(t){return i(t.component,{key:t.name,tag:"component",attrs:{classname:t.classname,"hover-classname":t.hoverClassname,"horizontal-position":t.horizontalDirection,"vertical-position":t.verticalDirection,disabled:t.disabled},on:{drag:function(i){return e.onHandlerDrag(i,t.horizontalDirection,t.verticalDirection)}}})})),1)],2)},we=[],be=void 0,ye=void 0,xe=void 0,_e=!1,Se=B({render:ve,staticRenderFns:we},be,ge,ye,_e,xe,void 0,void 0),ze=w("vue-draggable-area"),Ce={name:"DraggableArea",props:{movable:{type:Boolean,default:!0},activationDistance:{type:Number,default:10}},computed:{classnames:function(){return{default:v(ze(),this.classname)}}},beforeMount:function(){window.addEventListener("mouseup",this.onMouseUp,{passive:!1}),window.addEventListener("mousemove",this.onMouseMove,{passive:!1}),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd,{passive:!1})},beforeDestroy:function(){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},mounted:function(){this.touches=[],this.touchStarted=!1},methods:{onTouchStart:function(e){if(e.cancelable){var t=this.movable&&1===e.touches.length;t&&(this.touches=d(e.touches)),(this.touchStarted||t)&&(e.preventDefault(),e.stopPropagation())}},onTouchEnd:function(){this.touchStarted=!1,this.processEnd()},onTouchMove:function(e){1<=this.touches.length&&(this.touchStarted?(this.processMove(e,e.touches),e.preventDefault(),e.stopPropagation()):T({x:this.touches[0].clientX,y:this.touches[0].clientY},{x:e.touches[0].clientX,y:e.touches[0].clientY})>this.activationDistance&&(this.initAnchor({clientX:e.touches[0].clientX,clientY:e.touches[0].clientY}),this.touchStarted=!0))},onMouseDown:function(e){if(this.movable){var t={fake:!0,clientX:e.clientX,clientY:e.clientY};this.touches=[t],this.initAnchor(t),e.stopPropagation()}},onMouseMove:function(e){this.touches.length&&(this.processMove(e,[{fake:!0,clientX:e.clientX,clientY:e.clientY}]),e.preventDefault&&e.cancelable&&e.preventDefault(),e.stopPropagation())},onMouseUp:function(){this.touches=[]},initAnchor:function(e){var t=this.$refs.container,i=t.getBoundingClientRect(),n=i.left,o=i.top;this.anchor={x:e.clientX-n,y:e.clientY-o}},processMove:function(e,t){var i=d(t);if(this.touches.length){var n=this.$refs.container,o=n.getBoundingClientRect(),s=o.left,r=o.top;1===this.touches.length&&1===i.length&&this.$emit("move",new k(e,{left:i[0].clientX-s-this.anchor.x,top:i[0].clientY-r-this.anchor.y}))}},processEnd:function(){this.touches=[]}}},Ee=Ce,Te=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"container",on:{touchstart:e.onTouchStart,mousedown:e.onMouseDown}},[e._t("default")],2)},Me=[],Re=void 0,We=void 0,$e=void 0,ke=!1,De=B({render:Te,staticRenderFns:Me},Re,Ee,We,ke,$e,void 0,void 0),Ae=["left","right"],He=["top","bottom"],Oe=["left","right","top","bottom"],Be=["area","stencil","none"],Le=4,je=.1,Pe={left:0,top:0,width:0,height:0};function Ie(e,t,i){var n=Math.PI,o=i.flipped,s=i.orientation,r=t.naturalWidth,a=t.naturalHeight,h=e.getContext("2d");return e.width=r,e.height=a,h.save(),o&&(e.width=a,e.height=r),2==s?(h.translate(r,0),h.scale(-1,1)):3==s?(h.translate(r,a),h.rotate(1*n)):4==s?(h.translate(0,a),h.scale(1,-1)):5==s?(h.rotate(.5*n),h.scale(1,-1)):6==s?(h.rotate(.5*n),h.translate(0,-a)):7==s?(h.rotate(1.5*n),h.translate(-r,a),h.scale(1,-1)):8==s&&(h.translate(0,r),h.rotate(1.5*n)),h.drawImage(t,0,0,r,a),h.restore(),e}function Xe(e){var t={orientation:e};return e&&(2===e?t.scaleX=-1:3===e?t.rotate=-180:4===e?t.scaleY=-1:5===e?(t.rotate=90,t.scaleY=-1):6===e?t.rotate=90:7===e?(t.rotate=90,t.scaleX=-1):8===e&&(t.rotate=-90)),(90===t.rotate||-90===t.rotate)&&(t.flipped=!0),t}function Ye(e){var t=e.rotate,i=e.scaleX,n=e.scaleY,o="";return(t||i||n)&&(t&&(o+=" rotate(".concat(t,"deg) ")),i&&(o+=" scaleX(".concat(i,") ")),n&&(o+=" scaleY(".concat(n,") "))),o}function Ne(e){return new Promise((function(t){Fe(e).then((function(e){t(e?{arrayBuffer:e,orientation:Ge(e)}:{arrayBuffer:null,orientation:null})})).catch((function(e){console.warn(e),t({arrayBuffer:null,orientation:null})}))}))}function Fe(e){return new Promise((function(t,i){try{if(e)if(/^data:/i.test(e))t(Ve(e));else if(/^blob:/i.test(e)){var n=new FileReader;n.onload=function(e){t(e.target.result)},Ue(e,(function(e){n.readAsArrayBuffer(e)}))}else{var o=new XMLHttpRequest;o.onreadystatechange=function(){this.readyState!==Le||(200===this.status||0===this.status?t(this.response):i("Warning: could not load an image to parse its orientation"),o=null)},o.onprogress=function(){"image/jpeg"!==o.getResponseHeader("content-type")&&o.abort()},o.withCredentials=!1,o.open("GET",e,!0),o.responseType="arraybuffer",o.send(null)}else i("Error: the image is empty")}catch(t){i(t)}}))}function Ue(e,t){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=function(){(200==this.status||0===this.status)&&t(this.response)},i.send()}function Ve(e){e=e.replace(/^data:([^;]+);base64,/gim,"");for(var t=atob(e),i=t.length,n=new ArrayBuffer(i),o=new Uint8Array(n),s=0;s<i;s++)o[s]=t.charCodeAt(s);return n}function qe(e,t,i){var n,o="";for(n=t,i+=t;n<i;n++)o+=String.fromCharCode(e.getUint8(n));return o}function Ge(e){try{var t,i,n,o,s,r,a=new DataView(e);if(255===a.getUint8(0)&&216===a.getUint8(1))for(var h=a.byteLength,c=2;c+1<h;){if(255===a.getUint8(c)&&225===a.getUint8(c+1)){s=c;break}c++}if(s&&(i=s+4,n=s+10,"Exif"===qe(a,i,4))){var l=a.getUint16(n);if(o=18761===l,(o||19789===l)&&42===a.getUint16(n+2,o)){var u=a.getUint32(n+4,o);8<=u&&(r=n+u)}}if(r)for(var d,p=a.getUint16(r,o),m=0;m<p;m++)if(d=r+12*m+2,274===a.getUint16(d,o)){d+=8,t=a.getUint16(d,o),a.setUint16(d,1,o);break}return t}catch(e){return null}}function Ze(e){for(var t=[],i=8192,n=new Uint8Array(e);0<n.length;){var o=n.subarray(0,i);t.push(String.fromCharCode.apply(null,Array.from?Array.from(o):Array.slice(o))),n=n.subarray(i)}return"data:image/jpeg;base64,".concat(btoa(t.join("")))}var Je=w("vue-preview-result"),Ke={name:"PreviewResult",props:{img:{type:Object},classname:{type:String},imageClassname:{type:String},stencilCoordinates:{type:Object,default:function(){return{width:0,height:0,left:0,top:0}}}},computed:{classnames:function(){return{default:v(Je(),this.classname),image:v(Je("image"),this.imageClassname),wrapper:Je("wrapper")}},wrapperStyle:function(){return{width:"".concat(this.stencilCoordinates.width,"px"),height:"".concat(this.stencilCoordinates.height,"px"),left:"calc(50% - ".concat(this.stencilCoordinates.width/2,"px)"),top:"calc(50% - ".concat(this.stencilCoordinates.height/2,"px)")}},imageStyle:function(){var e=this.img.transforms,t=e.flipped,i=this.img.coefficient,n=this.img.size.height/i,o=this.img.size.width/i,s={width:"".concat(o,"px"),height:"".concat(n,"px")};return t?(s.width="".concat(n,"px"),s.height="".concat(o,"px"),s.left="".concat(-this.stencilCoordinates.left-(n-o)/2+e.translateX,"px"),s.top="".concat(-this.stencilCoordinates.top-(o-n)/2+e.translateY,"px")):(s.left="".concat(-this.stencilCoordinates.left+e.translateX,"px"),s.top="".concat(-this.stencilCoordinates.top+e.translateY,"px")),s.transform=Ye(e),s}}},Qe=Ke,et=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.classnames.default},[i("div",{ref:"wrapper",class:e.classnames.wrapper,style:e.wrapperStyle},[i("img",{ref:"image",class:e.classnames.image,style:e.imageStyle,attrs:{src:e.img.src}})])])},tt=[],it=void 0,nt=void 0,ot=void 0,st=!1,rt=B({render:et,staticRenderFns:tt},it,Qe,nt,st,ot,void 0,void 0),at={name:"CropperWrapper",props:{touchMove:{type:Object,required:!0},mouseMove:{type:Object,required:!0},touchResize:{type:Object,required:!0},wheelResize:{type:Object,required:!0}},beforeMount:function(){window.addEventListener("mouseup",this.onMouseUp,{passive:!1}),window.addEventListener("mousemove",this.onMouseMove,{passive:!1}),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd,{passive:!1})},beforeDestroy:function(){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},mounted:function(){this.touches=[]},methods:{onTouchStart:function(e){if(e.cancelable&&(this.touchMove.enabled||this.touchResize.enabled&&1<e.touches.length)){var t=this.$refs.container,i=t.getBoundingClientRect(),n=i.left,o=i.top,s=i.bottom,r=i.right;this.touches=d(e.touches).filter((function(e){return e.clientX>n&&e.clientX<r&&e.clientY>o&&e.clientY<s})),this.oldGeometricProperties=this.calculateGeometricProperties(this.touches),e.preventDefault&&e.preventDefault(),e.stopPropagation()}},onTouchEnd:function(e){0===e.touches.length&&this.processEnd()},onTouchMove:function(e){var t=this;if(this.touches.length){var i=d(e.touches).filter((function(e){return!e.identifier||t.touches.find((function(t){return t.identifier===e.identifier}))}));this.processMove(e,i),e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()}},onMouseDown:function(e){if(this.mouseMove&&"buttons"in e&&1===e.buttons){var t={fake:!0,clientX:e.clientX,clientY:e.clientY};this.touches=[t],e.stopPropagation()}},onMouseMove:function(e){this.touches.length&&(this.processMove(e,[{fake:!0,clientX:e.clientX,clientY:e.clientY}]),e.preventDefault&&e.cancelable&&e.preventDefault())},onMouseUp:function(){this.touches=[]},calculateGeometricProperties:function(e){var t=this.$refs.container,i=t.getBoundingClientRect(),n=i.left,o=i.top,s={left:0,top:0},r=0;return e.forEach((function(t){s.left+=(t.clientX-n)/e.length,s.top+=(t.clientY-o)/e.length})),e.forEach((function(e){r+=T({x:s.left,y:s.top},{x:e.clientX-n,y:e.clientY-o})})),{centerMass:s,spread:r,count:e.length}},processMove:function(e,t){if(this.touches.length){if(1===this.touches.length&&1===t.length&&this.touchMove.enabled)this.$emit("move",new W(e,{left:t[0].clientX-this.touches[0].clientX,top:t[0].clientY-this.touches[0].clientY}));else if(1<this.touches.length&&this.touchResize){var i=this.oldGeometricProperties,n=this.calculateGeometricProperties(t);i.count===n.count&&1<i.count&&this.$emit("resize",new W(e,{left:n.centerMass.left-i.centerMass.left,top:n.centerMass.top-i.centerMass.top},{factor:i.spread/n.spread,center:n.centerMass})),this.oldGeometricProperties=n}this.touches=t}},processEnd:function(){this.touches=[]},onWheel:function(e){if(this.wheelResize.enabled){var t=this.$refs.container,i=t.getBoundingClientRect(),n=i.left,o=i.top,s=1+this.wheelResize.ratio*Math.sign(e.deltaY||e.detail||e.wheelDelta),r={left:e.clientX-n,top:e.clientY-o};this.$emit("resize",new W(e,{},{factor:s,center:r})),e.preventDefault(),e.stopPropagation()}}}},ht=at,ct=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"container",on:{touchstart:e.onTouchStart,mousedown:e.onMouseDown,wheel:e.onWheel}},[e._t("default")],2)},lt=[],ut=void 0,dt=void 0,pt=void 0,mt=!1,ft=B({render:ct,staticRenderFns:lt},ut,ht,dt,mt,pt,void 0,void 0),gt=w("vue-square-handler"),vt={name:"SimpleHandler",components:{HandlerWrapper:te},props:{classname:{type:String},hoverClassname:{type:String},horizontalPosition:{type:String},verticalPosition:{type:String},disabled:{type:Boolean,default:!1}},computed:{classnames:function(){return{default:v(gt(l({},this.position,!0)),this.classname,this.hover&&this.hoverClassname)}}},methods:{onDrag:function(e){this.$emit("drag",e)},onEnter:function(){this.hover=!0},onLeave:function(){this.hover=!1}}},wt=vt,bt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("HandlerWrapper",{attrs:{"vertical-position":e.verticalPosition,"horizontal-position":e.horizontalPosition,disabled:e.disabled},on:{drag:e.onDrag}},[i("div",{class:e.classnames.default})])},yt=[],xt=void 0,_t=void 0,St=void 0,zt=!1,Ct=B({render:bt,staticRenderFns:yt},xt,wt,_t,zt,St,void 0,void 0),Et=w("vue-simple-line"),Tt={name:"SimpleLine",components:{LineWrapper:ue},props:{classname:{type:String},hoverClassname:{type:String},position:{type:String},disabled:{type:Boolean,default:!1}},data:function(){return{hover:!1}},computed:{classnames:function(){return{default:v(Et(l({},this.position,!0)),this.classname,this.hover&&this.hoverClassname)}}},methods:{onDrag:function(e){this.$emit("drag",e)},onEnter:function(){this.hover=!0},onLeave:function(){this.hover=!1}}},Mt=Tt,Rt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("LineWrapper",{attrs:{position:e.position,disabled:e.disabled},on:{enter:e.onEnter,leave:e.onLeave,drag:e.onDrag}},[i("div",{class:e.classnames.default})])},Wt=[],$t=void 0,kt=void 0,Dt=void 0,At=!1,Ht=B({render:Rt,staticRenderFns:Wt},$t,Mt,kt,At,Dt,void 0,void 0),Ot=w("vue-rectangle-stencil"),Bt={name:"RectangleStencil",components:{PreviewResult:rt,BoundingBox:Se,DraggableArea:De},props:{img:{type:Object},resultCoordinates:{type:Object},stencilCoordinates:{type:Object},handlers:{type:Object},handlerComponent:{type:[Object,String],default:function(){return Ct}},handlersClassnames:{type:Object,default:function(){return{}}},lines:{type:Object},lineComponent:{type:[Object,String],default:function(){return Ht}},linesClassnames:{type:Object,default:function(){return{}}},classname:{type:String},previewClassname:{type:String},boundingBoxClassname:{type:String},aspectRatio:{type:[Number,String]},minAspectRatio:{type:[Number,String]},maxAspectRatio:{type:[Number,String]},movable:{type:Boolean,default:!0},scalable:{type:Boolean,default:!0}},computed:{classes:function(){return{stencil:v(Ot({movable:this.movable}),this.classname),preview:v(Ot("preview"),this.previewClassname),boundingBox:v(Ot("bounding-box"),this.boundingBoxClassname)}},style:function(){var e=this.stencilCoordinates,t=e.height,i=e.width,n=e.left,o=e.top;return{width:"".concat(i,"px"),height:"".concat(t,"px"),left:"".concat(n,"px"),top:"".concat(o,"px")}}},methods:{onMove:function(e){this.$emit("move",e)},onResize:function(e){this.$emit("resize",e)},aspectRatios:function(){return{minimum:this.aspectRatio||this.minAspectRatio,maximum:this.aspectRatio||this.maxAspectRatio}}}},Lt=Bt,jt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.classes.stencil,style:e.style},[i("BoundingBox",{attrs:{classname:e.classes.boundingBox,handlers:e.handlers,"handler-component":e.handlerComponent,"handlers-classnames":e.handlersClassnames,lines:e.lines,"line-component":e.lineComponent,"lines-classnames":e.linesClassnames,scalable:e.scalable},on:{resize:e.onResize}},[i("DraggableArea",{attrs:{movable:e.movable},on:{move:e.onMove}},[i("PreviewResult",{attrs:{img:e.img,classname:e.classes.preview,"result-coordinates":e.resultCoordinates,"stencil-coordinates":e.stencilCoordinates}})],1)],1)],1)},Pt=[],It=void 0,Xt=void 0,Yt=void 0,Nt=!1,Ft=B({render:jt,staticRenderFns:Pt},It,Lt,Xt,Nt,Yt,void 0,void 0),Ut=w("vue-circle-stencil"),Vt={name:"CircleStencil",components:{PreviewResult:rt,BoundingBox:Se,DraggableArea:De},props:{img:{type:Object},stencilClass:{type:String},resultCoordinates:{type:Object},stencilCoordinates:{type:Object},handlers:{type:Object,default:function(){return{eastNorth:!0,westNorth:!0,westSouth:!0,eastSouth:!0}}},handlerComponent:{type:[Object,String],default:function(){return Ct}},handlersClassnames:{type:Object,default:function(){return{}}},lines:{type:Object},lineComponent:{type:[Object,String],default:function(){return Ht}},linesClassnames:{type:Object,default:function(){return{}}},classname:{type:String},previewClassname:{type:String},boundingBoxClassname:{type:String},movable:{type:Boolean,default:!0},scalable:{type:Boolean,default:!0}},computed:{classes:function(){return{stencil:v(Ut(),this.classname),preview:v(Ut("preview"),this.previewClassname),boundingBox:v(Ut("bounding-box"),this.boundingBox)}},style:function(){var e=this.stencilCoordinates,t=e.height,i=e.width,n=e.left,o=e.top;return{width:"".concat(i,"px"),height:"".concat(t,"px"),left:"".concat(n,"px"),top:"".concat(o,"px")}}},methods:{onMove:function(e){this.$emit("move",e)},onResize:function(e){this.$emit("resize",e)},aspectRatios:function(){return{minimum:1,maximum:1}}}},qt=Vt,Gt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.classes.stencil,style:e.style},[i("BoundingBox",{attrs:{classname:e.classes.boundingBox,handlers:e.handlers,"handler-component":e.handlerComponent,"handlers-classnames":e.handlersClassnames,lines:e.lines,"line-component":e.lineComponent,"lines-classnames":e.linesClassnames,scalable:e.scalable},on:{resize:e.onResize}},[i("DraggableArea",{attrs:{movable:e.movable},on:{move:e.onMove}},[i("PreviewResult",{attrs:{img:e.img,classname:e.classes.preview,"result-coordinates":e.resultCoordinates,"stencil-coordinates":e.stencilCoordinates}})],1)],1)],1)},Zt=[],Jt=void 0,Kt=void 0,Qt=void 0,ei=!1,ti=B({render:Gt,staticRenderFns:Zt},Jt,qt,Kt,ei,Qt,void 0,void 0);function ii(e){return{left:e.left,top:e.top,right:e.left+e.width,bottom:e.top+e.height}}function ni(e){return"right"===e?"left":"bottom"===e?"top":"left"===e||"top"===e?e:void 0}function oi(e,t){return e.width+(t.left+t.right)}function si(e,t){return e.height+(t.top+t.bottom)}function ri(e,t,i){var n=Math.min,o=Math.ceil;return{left:"left"in i?-n(0,o(e.left-i.left)-t.left):0,top:"top"in i?-n(0,o(e.top-i.top)-t.top):0,bottom:"bottom"in i?-n(0,i.bottom-(e.bottom+t.bottom)):0,right:"right"in i?-n(0,i.right-(e.right+t.right)):0}}function ai(e){var t=Math.max,i=Math.min,n=e.directions,o=e.coordinates,s=e.restrictions,r=e.preserveAspectRatio,a=e.stopOnBreak,h=e.mode,c=void 0===h?"crop":h,l=e.allowedArea,p=void 0===l?{}:l,m=u({},n),f=oi(o,m),g=si(o,m);0>f&&(0>m.left&&0>m.right?(m.left=-(o.width-s.minWidth)/(m.left/m.right),m.right=-(o.width-s.minWidth)/(m.right/m.left)):0>m.left?m.left=-(o.width-s.minWidth):0>m.right&&(m.right=-(o.width-s.minWidth))),0>g&&(0>m.top&&0>m.bottom?(m.top=-(o.height-s.minHeight)/(m.top/m.bottom),m.bottom=-(o.height-s.minHeight)/(m.bottom/m.top)):0>m.top?m.top=-(o.height-s.minHeight):0>m.bottom&&(m.bottom=-(o.height-s.minHeight)));var v=ri(o,m,p);"move"===c&&(0<v.left&&0===v.right?(m.right+=v.left,m.left-=v.left):0<v.right&&0===v.left&&(m.left+=v.right,m.right-=v.right),0<v.top&&0===v.bottom?(m.bottom+=v.top,m.top-=v.top):0<v.bottom&&0===v.top&&(m.top+=v.bottom,m.bottom-=v.bottom),v=ri(o,m,p));var w={width:1/0,height:1/0};if(Oe.forEach((function(e){w[e]=v[e]&&m[e]?t(0,1-v[e]/m[e]):1/0})),r){var b=i.apply(Math,d(Oe.map((function(e){return w[e]}))));b!==1/0&&Oe.forEach((function(e){m[e]*=b}))}else Ae.forEach((function(e){var t=a?i(w.top,w.bottom):w[e];t!==1/0&&(m[e]*=t)})),He.forEach((function(e){var t=a?i(w.top,w.bottom):w[e];t!==1/0&&(m[e]*=t)}));if(f=oi(o,m),g=si(o,m),m.right+m.left&&(f>s.maxWidth?w.width=(s.maxWidth-o.width)/(m.right+m.left):f<s.minWidth&&(w.width=(s.minWidth-o.width)/(m.right+m.left))),m.bottom+m.top&&(g>s.maxHeight?w.height=(s.maxHeight-o.height)/(m.bottom+m.top):g<s.minHeight&&(w.height=(s.minHeight-o.height)/(m.bottom+m.top))),r){var y=i(w.width,w.height);y!==1/0&&Oe.forEach((function(e){m[e]*=y}))}else w.width!==1/0&&Ae.forEach((function(e){m[e]*=w.width})),w.height!==1/0&&He.forEach((function(e){m[e]*=w.height}));return m}function hi(e,t,i,n,o){var s;return i.minimum&&e/t<i.minimum?s=i.minimum:i.maximum&&e/t>i.maximum?s=i.maximum:o&&(s=n.width/n.height),s}function ci(e){var t=Math.abs,i=e.coordinates,n=e.restrictions,o=e.allowedArea,s=e.aspectRatio,r=e.resizeEvent,a=u({},i,{right:i.left+i.width,bottom:i.top+i.height}),h=r.params||{},c=u({},r.directions),l=h.allowedDirections||{left:!0,right:!0,bottom:!0,top:!0};Oe.forEach((function(e){l[e]||(c[e]=0)})),c=ai({directions:c,restrictions:n,coordinates:a,allowedArea:o,stopOnBreak:h.stopOnBreak});var d=oi(a,c),p=si(a,c),m=hi(d,p,s,a,h.preserveAspectRatio);if(m){var f=h.respectDirection;if(f||(f=a.width>=a.height||1==m?"width":"height"),"width"===f){var g=d/m-a.height;l.top&&l.bottom?(c.bottom=g/2,c.top=g/2):l.bottom?c.bottom=g:l.top?c.top=g:l.right?c.right=0:l.left&&(c.left=0)}else if("height"===f){var v=a.width-p*m;l.left&&l.right?(c.left=-v/2,c.right=-v/2):l.left?c.left=-v:l.right?c.right=-v:l.top?c.top=0:l.bottom&&(c.bottom=0)}c=ai({directions:c,restrictions:n,coordinates:a,allowedArea:o,preserveAspectRatio:!0,mode:h.compensate&&!h.stopOnBreak?"move":"crop"})}return d=oi(a,c),p=si(a,c),m=hi(d,p,s,a,h.preserveAspectRatio),.001<t(m-d/p)&&(console.error("Something went wrong and ratio was broken: ".concat(d/p," instead of ").concat(m)),Oe.forEach((function(e){l[e]||(c[e]=0)}))),li({coordinates:{width:i.width+c.right+c.left,height:i.height+c.top+c.bottom,left:i.left,top:i.top},allowedArea:o,moveEvent:new k({},{left:-c.left,top:-c.top})})}function li(e){var t=e.coordinates,i=e.allowedArea,n=void 0===i?{}:i,o=e.moveEvent,s=u({},o.directions),r={left:t.left+s.left,top:t.top+s.top,width:t.width,height:t.height};return"left"in n&&r.left<n.left&&(r.left=n.left),"right"in n&&r.left+r.width>n.right&&(r.left=n.right-r.width),"top"in n&&r.top<n.top&&(r.top=n.top),"bottom"in n&&r.top+r.height>n.bottom&&(r.top=n.bottom-r.height),r}function ui(e){var t=e.cropper,i=(e.image,e.imageWidth),n=e.imageHeight,o=t.clientHeight,s=t.clientWidth,r=o,a=i*o/n;return a>s&&(a=s,r=n*s/i),{width:a,height:r}}function di(e){e.cropper,e.image;var t=e.stencilWidth,i=e.stencilHeight,n=e.imageWidth,o=e.imageHeight;e.props;return{left:n/2-t/2,top:o/2-i/2}}function pi(e){var t,i,n=Math.max,o=Math.min,s=(e.cropper,e.image,e.minWidth),r=e.minHeight,a=e.maxWidth,h=e.maxHeight,c=e.imageWidth,l=e.imageHeight,u=e.aspectRatio,d=(e.props,c),p=l,m=c>l?u.maximum:u.minimum;return(c/l>u.maximum||c/l<u.minimum)&&(1>=m?(p=l,d=p*u.maximum):(d=c,p=d/u.minimum)),t=o(h,n(r,.8*p)),i=o(a,n(s,.8*d)),{height:t,width:i}}function mi(e){var t=e.minWidth,i=e.minHeight,n=e.maxWidth,o=e.maxHeight,s=e.imageWidth,r=e.imageHeight;return{minWidth:t/100*s,minHeight:i/100*r,maxWidth:n/100*s,maxHeight:o/100*r}}function fi(e){var t=Math.min,i=e.coordinates,n=e.stencilCoordinates,o=e.worldTransforms,s=e.coefficient,r=e.imageSize,a=e.allowedArea,h=u({},o),c={width:h.scale*i.width/s,height:h.scale*i.height/s,left:n.left,top:n.top};h.shift.left-=i.left*h.scale+h.shift.left-n.left*s,h.shift.top-=i.top*h.scale+h.shift.top-n.top*s;var l=1;c.width>r.width/s&&(l=t(l,r.width/s/c.width)),c.height>r.height/s&&(l=t(l,r.height/s/c.height)),1!==l&&(h.scale*=l,c.left+=c.width*(1-l)/2,c.top+=c.height*(1-l)/2,h.shift.left=c.left*s-i.left*h.scale,h.shift.top=c.top*s-i.top*h.scale,c.width*=l,c.height*=l),0>c.left&&(h.shift.left-=c.left*s,c.left=0),0>c.top&&(h.shift.top-=c.top*s,c.top=0),c.left+c.width>r.width/s&&(h.shift.left-=(c.left+c.width)*s-r.width,c.left=r.width/s-c.width),c.top+c.height>r.height/s&&(h.shift.top-=(c.top+c.height)*s-r.height,c.top=r.height/s-c.height);var d={width:r.width*h.scale,height:r.height*h.scale};return h.shift.left>-a.left*h.scale&&(c.left-=(h.shift.left+a.left*h.scale)/s,h.shift.left=-a.left*h.scale),h.shift.left<r.width-d.width-(a.right-r.width)*h.scale&&(c.left-=(h.shift.left-(r.width-d.width)+(a.right-r.width)*h.scale)/s,h.shift.left=r.width-d.width-(a.right-r.width)*h.scale),h.shift.top>-a.top*h.scale&&(c.top-=(h.shift.top+a.top*h.scale)/s,h.shift.top=-a.top*h.scale),h.shift.top<r.height-d.height-(a.bottom-r.height)*h.scale&&(c.top-=(h.shift.top-(r.height-d.height)+(a.bottom-r.height)*h.scale)/s,h.shift.top=r.height-d.height-(a.bottom-r.height)*h.scale),{stencilCoordinates:c,worldTransforms:h}}function gi(e){var t=Math.abs,i=Math.max,n=Math.min,o=Math.ceil,s=e.manipulateImageEvent,r=e.coordinates,a=e.stencilRestrictions,h=e.coefficient,c=e.stencilCoordinates,l=e.worldTransforms,d=e.imageSize,p=e.frozenDirections,m=e.allowedArea,f=e.fitImage,g=s.scale,v=s.move,w=u({},l),b={width:d.width*w.scale,height:d.height*w.scale},y={left:v.left||0,top:v.top||0},x=1,_=1,S=f?1:i("left"in m&&"right"in m?c.width*h/(m.right-m.left):.01,"top"in m&&"bottom"in m?c.height*h/(m.bottom-m.top):.01);if(!p.width&&!p.height&&.001<t(g.factor-1)){var z=t(1-x)/2,C=a.maxWidth,E=a.maxHeight,T=a.minWidth,M=a.minHeight;x=g.factor,w.scale/x<S+z&&(x=w.scale/S);var R=r.width*x,W=r.height*x,$={minWidth:R<T+z,minHeight:W<M+z,maxWidth:R>C-z,maxHeight:W>E-z};if($.minWidth&&(x=T/r.width),$.minHeight&&(x=M/r.height),$.maxHeight||$.maxWidth){var k=x;$.maxWidth&&$.maxHeight?k=n(E/r.height,r.width):$.maxHeight?k=E/r.height:$.maxWidth&&(k=C/r.width),1<=w.scale*x?_=k/x:x=k}var D={width:b.width*(1-1/x),height:b.height*(1-1/x)};y.left+=D.width*t((w.shift.left-g.center.left*h)/b.width),y.top+=D.height*t((w.shift.top-g.center.top*h)/b.height),b.width/=x,b.height/=x}if(w.scale/=x,f)0<o(w.shift.left+y.left)?y.left=-w.shift.left:w.shift.left+y.left<d.width-b.width&&(y.left=d.width-b.width-w.shift.left),0<o(w.shift.top+y.top)?y.top=-w.shift.top:w.shift.top+y.top<d.height-b.height&&(y.top=d.height-b.height-w.shift.top);else{var A={};Oe.forEach((function(e){A[e]=e in m?w.shift[ni(e)]+y[ni(e)]+(m[e]*w.scale-ii(c)[e]*h):0})),0<A.left?y.left-=A.left:0>A.right&&(y.left-=A.right),0<A.top?y.top-=A.top:0>A.bottom&&(y.top-=A.bottom)}w.shift.left+=y.left,w.shift.top+=y.top;var H={left:0,top:0};return d.width!==r.width&&1<=w.scale&&(H.left=c.width*(1-_)*(r.left/(d.width-r.width))),d.height!==r.height&&1<=w.scale&&(H.top=c.height*(1-_)*(r.top/(d.height-r.height))),{coordinates:{width:r.width*x*_,height:r.height*x*_,left:(c.left-w.shift.left/h+H.left)*h/w.scale,top:(c.top-w.shift.top/h+H.top)*h/w.scale},worldTransforms:w}}function vi(e){var t=Math.max,i=Math.min,n=e.breakBoundaries,o=e.imageSize,s=e.worldTransforms,r=e.imageRestriction,a={};if("none"!==r&&(a={left:0,top:0,right:o.width,bottom:o.height}),!n){var h={left:-s.shift.left/s.scale,top:-s.shift.top/s.scale,right:(o.width-s.shift.left)/s.scale,bottom:(o.height-s.shift.top)/s.scale};Oe.forEach((function(e){a[e]=z(a[e])?h[e]:"left"===e||"top"===e?t(a[e],h[e]):i(a[e],h[e])}))}return a}var wi=w("vue-advanced-cropper");function bi(e,t,i){function n(n){return console.warn("The arguments will be passed to the prop '".concat(t,"' as an single object {").concat(Object.keys(n).join(","),"} in the future releases. You should change the interface of your function.")),e.apply(void 0,d(i(n)))}return function(t){if(1<e.length)return n(t);try{return e(t)}catch(i){return n(t)}}}var yi={name:"Cropper",components:{CropperWrapper:ft},props:{src:{type:String,default:null},allowedArea:{type:Function,default:vi},resizeAlgorithm:{type:Function,default:ci},moveAlgorithm:{type:Function,default:li},defaultSize:{type:Function,default:pi},defaultPosition:{type:Function,default:di},areaSize:{type:Function,default:ui},restrictions:{type:Function,default:mi},minWidth:{type:[Number,String]},minHeight:{type:[Number,String]},maxWidth:{type:[Number,String]},maxHeight:{type:[Number,String]},stencilComponent:{type:[Object,String],default:function(){return Ft}},stencilProps:{type:Object,default:function(){return{}}},classname:{type:String},imageClassname:{type:String},areaClassname:{type:String},backgroundClassname:{type:String},debounce:{type:Number,default:500},canvas:{type:Boolean,default:!0},checkCrossOrigin:{type:Boolean,default:!0},checkOrientation:{type:Boolean,default:!0},transitionTime:{type:Number,default:300},wheelResize:{type:[Boolean,Object],default:!0},touchResize:{type:[Boolean,Object],default:!0},touchMove:{type:[Boolean,Object],default:!0},mouseMove:{type:[Boolean,Object],default:!0},imageRestriction:{type:[String],default:"area",validator:function(e){return-1!==Be.indexOf(e)}}},data:function(){return{boundarySize:{width:null,height:null},imageLoaded:!1,imageAttributes:{crossOrigin:!1,src:null},basicImageTransforms:{rotate:null,scaleX:null,scaleY:null},imageSize:{width:null,height:null},coordinates:u({},Pe),stencilCoordinates:u({},Pe),frozenDirections:{width:!1,height:!1},worldTransforms:{scale:1,shift:{left:0,top:0}}}},computed:{settings:function(){var e={touchResize:M(this.touchResize),touchMove:M(this.touchMove),mouseMove:M(this.mouseMove),wheelResize:M(this.wheelResize,{ratio:.1})};return e.touchMove.enabled=e.touchMove.enabled&&(1!==this.worldTransforms.scale||"none"===this.imageRestriction),e},imageTransforms:function(){return u({},this.basicImageTransforms,{scaleX:(this.basicImageTransforms.scaleX||1)*this.worldTransforms.scale,scaleY:(this.basicImageTransforms.scaleY||1)*this.worldTransforms.scale,translateX:this.worldTransforms.shift.left/this.coefficient+(this.imageSize.width*this.worldTransforms.scale-this.imageSize.width)/2/this.coefficient,translateY:this.worldTransforms.shift.top/this.coefficient+(this.imageSize.height*this.worldTransforms.scale-this.imageSize.height)/2/this.coefficient})},coefficient:function(){return this.imageSize.width?this.imageSize.width/this.boundarySize.width:0},classes:function(){return{cropper:v(wi(),this.classname),image:v(wi("image"),this.imageClassname),area:v(wi("area"),this.areaClassname),stretcher:v(wi("stretcher")),background:v(wi("background"),this.backgroundClassname),imageWrapper:v(wi("image-wrapper")),cropperWrapper:v(wi("cropper-wrapper"))}},wrapperStyle:function(){return{width:"".concat(this.stencilCoordinates.width,"px"),height:"".concat(this.stencilCoordinates.height,"px"),left:"".concat(this.stencilCoordinates.left,"px"),top:"".concat(this.stencilCoordinates.top,"px")}},areaStyle:function(){return{width:this.boundarySize.width?"".concat(this.boundarySize.width,"px"):"auto",height:this.boundarySize.height?"".concat(this.boundarySize.height,"px"):"auto",opacity:this.imageLoaded?1:0,transition:"opacity ".concat(this.transitionTime,"ms"),pointerEvents:this.imageLoaded?"all":"none"}},imageStyle:function(){var e={left:"calc(50% + ".concat(this.imageTransforms.translateX,"px)"),top:"calc(50% + ".concat(this.imageTransforms.translateY,"px)"),transform:"translate(-50%, -50%)"+Ye(this.imageTransforms)},t=this.imageTransforms.flipped;return t?(e.width="".concat(this.boundarySize.height,"px"),e.height="".concat(this.boundarySize.width,"px")):(e.width="".concat(this.boundarySize.width,"px"),e.height="".concat(this.boundarySize.height,"px")),e},stencilRestrictions:function(){var e=Math.floor,t=Math.max,i={minWidth:z(this.minWidth)?0:this.minWidth,minHeight:z(this.minHeight)?0:this.minHeight,maxWidth:z(this.maxWidth)?1/0:this.maxWidth,maxHeight:z(this.maxHeight)?1/0:this.maxHeight},n=bi(this.restrictions,"restrictions",(function(e){return[e.minWidth,e.minHeight,e.maxWidth,e.maxHeight,e.imageWidth,e.imageHeight]}))({minWidth:R(i.minWidth),minHeight:R(i.minHeight),maxWidth:R(i.maxWidth),maxHeight:R(i.maxHeight),imageWidth:this.imageSize.width,imageHeight:this.imageSize.height,props:this.$props}),o=t(je*this.imageSize.width/this.coefficient/this.worldTransforms.scale,je*this.imageSize.height/this.coefficient/this.worldTransforms.scale);return n.minWidth<o&&(n.minWidth=e(o)),n.minHeight<o&&(n.minHeight=e(o)),n.minWidth>n.maxWidth&&(console.warn("Warning: maximum width (".concat(n.maxWidth,"px) fewer that the minimum width (").concat(n.minWidth,"px). It is set equal to the minimum width and width resizing was blocked")),n.maxWidth=n.minWidth,n.widthFrozen=!0),n.minHeight>n.maxHeight&&(console.warn("Warning: maximum height (".concat(n.maxHeight,"px) fewer that the minimum height (").concat(n.minHeight,"px). It is set equal to the minimum height and height resizing was blocked")),n.maxHeight=n.minHeight,n.heightFrozen=!0),"none"!==this.imageRestriction&&((!n.maxWidth||n.maxWidth>this.imageSize.width)&&(n.maxWidth=this.imageSize.width),(!n.maxHeight||n.maxHeight>this.imageSize.height)&&(n.maxHeight=this.imageSize.height)),n}},watch:{src:function(){this.onChangeImage()},minWidth:function(){this.onPropsChange()},maxWidth:function(){this.onPropsChange()},minHeight:function(){this.onPropsChange()},maxHeight:function(){this.onPropsChange()},imageRestriction:function(){this.resetCoordinates()},stencilProps:function(e,t){["aspectRatio","minAspectRatio","maxAspectRatio"].find((function(i){return e[i]!==t[i]}))&&s["a"].nextTick(this.onPropsChange)}},mounted:function(){var e=this;this.debouncedUpdate=y(this.update,this.debounce),window.addEventListener("resize",this.onResizeWindow),window.addEventListener("orientationchange",this.onResizeWindow),this.$refs.image.addEventListener("load",(function(){e.onLoadImage()})),this.onChangeImage()},destroyed:function(){window.removeEventListener("resize",this.refreshImage),window.removeEventListener("orientationchange",this.refreshImage)},methods:{getResult:function(){return this.canvas&&this.src?(this.updateCanvas(this.coordinates),{coordinates:u({},this.coordinates),canvas:this.$refs.canvas}):{coordinates:u({},this.coordinates)}},getArea:function(){return this.$refs.area},getStencil:function(){return this.$refs.stencil},autoZoom:function(e){var t=fi({coordinates:e,stencilCoordinates:this.stencilCoordinates,worldTransforms:this.worldTransforms,coefficient:this.coefficient,imageSize:this.imageSize,allowedArea:this.getAllowedArea(!0)}),i=t.worldTransforms,n=t.stencilCoordinates;this.worldTransforms=i,this.stencilCoordinates=n},updateStencilCoordinates:function(e){var t=e.width,i=e.height,n=e.left,o=e.top;this.stencilCoordinates={width:this.worldTransforms.scale*t/this.coefficient,height:this.worldTransforms.scale*i/this.coefficient,left:(n*this.worldTransforms.scale+this.worldTransforms.shift.left)/this.coefficient,top:(o*this.worldTransforms.scale+this.worldTransforms.shift.top)/this.coefficient}},updateCanvas:function(e){if(this.$refs.canvas){var t=this.$refs.image,i=this.checkOrientation?Ie(this.$refs.sourceCanvas,t,this.imageTransforms):t,n=this.$refs.canvas;n.width=e.width,n.height=e.height;var o=n.getContext("2d");o.drawImage(i,e.left,e.top,e.width,e.height,0,0,e.width,e.height)}},update:function(){this.$emit("change",this.getResult())},onResizeWindow:function(){var e=this,t=this.$refs.image;this.src&&t&&this.refreshImage().then((function(){e.updateStencilCoordinates(e.coordinates)}))},onChangeCoordinates:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.coordinates=e,this.$listeners&&this.$listeners.change&&(t?this.debouncedUpdate():this.update())},onChangeImage:function(){var e=this;if(this.imageLoaded=!1,this.delayedTransforms=null,this.src){var t=S(this.src);t&&this.canvas&&this.checkCrossOrigin&&(this.imageAttributes.crossOrigin="anonymous"),setTimeout((function(){e.checkOrientation?Ne(t?E(e.src):e.src).then(e.onParseImage):e.onParseImage({})}),this.transitionTime)}else this.clearImage()},onLoadImage:function(){var e=this;this.$refs.image&&!this.imageLoaded&&(this.imageLoaded=!0,this.refreshImage().then((function(){e.resetCoordinates(),e.$emit("ready")})))},onParseImage:function(e){var t=this,i=e.arrayBuffer,n=e.orientation;this.imageAttributes.src=i&&n&&_(this.src)?Ze(i):this.src,this.basicImageTransforms=Xe(n),s["a"].nextTick((function(){var e=t.$refs.image;e&&e.complete&&t.onLoadImage()}))},onResize:function(e){var t=this;this.frozenDirections.width&&(e.directions.left=0,e.directions.right=0),this.frozenDirections.height&&(e.directions.top=0,e.directions.bottom=0),Oe.forEach((function(i){e.directions[i]/=t.worldTransforms.scale/t.coefficient})),this.onChangeCoordinates(this.resizeAlgorithm({coordinates:this.coordinates,restrictions:this.stencilRestrictions,allowedArea:this.getAllowedArea(),aspectRatio:this.stencilAspectRatios(),resizeEvent:e})),this.updateStencilCoordinates(this.coordinates)},onManipulateImage:function(e){e.move.left&&(e.move.left*=this.coefficient),e.move.top&&(e.move.top*=this.coefficient);var t=gi({manipulateImageEvent:e,coordinates:this.coordinates,coefficient:this.coefficient,stencilRestrictions:this.stencilRestrictions,imageSize:this.imageSize,frozenDirections:this.frozenDirections,stencilCoordinates:this.stencilCoordinates,worldTransforms:this.worldTransforms,allowedArea:this.getAllowedArea(!0),minScale:"none"===this.imageRestriction?je:1,fitImage:"area"===this.imageRestriction}),i=t.worldTransforms,n=t.coordinates;this.worldTransforms=i,this.onChangeCoordinates(n),this.updateStencilCoordinates(n)},onMove:function(e){var t=this;Oe.forEach((function(i){e.directions[i]/=t.worldTransforms.scale/t.coefficient})),this.onChangeCoordinates(this.moveAlgorithm({coordinates:this.coordinates,allowedArea:this.getAllowedArea(),moveEvent:e})),this.updateStencilCoordinates(this.coordinates)},defaultCoordinates:function(){var e=Math.max,t=Math.min,i=this.stencilAspectRatios(),n=this.stencilRestrictions,o=n.minWidth,s=n.minHeight,r=n.maxWidth,a=n.maxHeight,h=this.imageSize,c={};if(i.minimum||i.maximum){var l={width:{maximum:i.minimum?t(a,o/i.minimum):a,minimum:i.maximum?e(s,o/i.maximum):s},height:{maximum:i.maximum?t(r,s*i.maximum):r,minimum:i.minimum?e(o,s*i.minimum):o}};if(l.width.maximum>=l.width.minimum)c.width=o,c.height=l.width.minimum;else{if(!(l.height.maximum>=l.height.minimum))throw"Error: current aspect ratio is incompatible with minimum/maximum height and width settings. Can't setup default coordinates";c.height=s,c.width=l.height.minimum}}else c.height=s,c.width=o;return c.left=h.width/2-c.width/2,c.top=h.height/2-c.height/2,c},setCoordinates:function(e){var t=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=i.autoZoom;s["a"].nextTick((function(){return t.imageLoaded?void t.applyTransforms(e,!(void 0!==n)||n):void(t.delayedTransforms=e)}))},onPropsChange:function(){this.applyTransforms(this.coordinates,!0)},applyTransforms:function(e){var t=this,i=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],n=this.stencilAspectRatios(),o=this.getAllowedArea(!0),s=function(e,i){return t.moveAlgorithm({coordinates:e,allowedArea:o,moveEvent:new k(null,{left:i.left-e.left,top:i.top-e.top})})},r=function(e,i){var r=t.defaultCoordinates();return r=t.resizeAlgorithm({coordinates:r,restrictions:t.stencilRestrictions,allowedArea:o,aspectRatio:n,resizeEvent:new $(null,{left:(i.width-r.width)/2,right:(i.width-r.width)/2,top:(i.height-r.height)/2,bottom:(i.height-r.height)/2})}),s(r,{left:e.left,top:e.top})},a=this.coordinates;return Array.isArray(e)||(e=[e]),e.forEach((function(e){var i={};i="function"==typeof e?e(u({},a),t.imageSize):e,z(i.width)&&z(i.height)||(a=r(a,u({},a,i))),z(i.left)&&z(i.top)||(a=s(a,u({},a,i)))})),i?this.autoZoom(a):(1<this.worldTransforms.scale&&this.resetWorldTransforms(),this.updateStencilCoordinates(a)),this.onChangeCoordinates(a,!1),a},resetWorldTransforms:function(){this.worldTransforms={scale:1,shift:{left:0,top:0}}},resetCoordinates:function(){var e=this;if(this.$refs.image){var t=this.$refs.cropper,i=this.$refs.image,n=this.stencilRestrictions,o=n.minWidth,s=n.minHeight,r=n.maxWidth,a=n.maxHeight,h=n.widthFrozen,c=n.heightFrozen;this.frozenDirections.width=!!h,this.frozenDirections.height=!!c;var l=bi(this.defaultSize,"defaultSize",(function(e){return[e.cropper,e.image,{minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight},e.imageWidth,e.imageHeight,e.props]}))(u({cropper:t,image:i,imageWidth:this.imageSize.width,imageHeight:this.imageSize.height,props:this.$props,aspectRatio:this.stencilAspectRatios()},this.stencilRestrictions));(l.width<o||l.height<s||l.width>r||l.height>a)&&console.warn("Warning: default size breaking size restrictions. Check your defaultSize function",l,this.stencilRestrictions);var p=[l,function(n){return u({},bi(e.defaultPosition,"defaultPosition",(function(e){return[e.cropper,e.image,e.stencilWidth,e.stencilHeight,e.imageWidth,e.imageHeight,e.props]}))({cropper:t,image:i,stencilWidth:n.width,stencilHeight:n.height,imageWidth:e.imageSize.width,imageHeight:e.imageSize.height,props:e.$props}))}];this.delayedTransforms&&p.push.apply(p,d(Array.isArray(this.delayedTransforms)?this.delayedTransforms:[this.delayedTransforms])),this.resetWorldTransforms(),this.applyTransforms(p),this.delayedTransforms=null}},clearImage:function(){var e=this,t=this.$refs.stretcher;this.imageLoaded=!1,setTimeout((function(){t.style.height="auto",t.style.width="auto",e.onChangeCoordinates(u({},Pe),!1),e.updateStencilCoordinates(u({},Pe)),e.boundarySize={width:0,height:0}}),this.transitionTime)},refreshImage:function(){var e=this;return new Promise((function(t,i){var n=e.$refs.image,o=e.$refs.cropper;if(e.src&&n){var r=e.$refs.stretcher;e.imageTransforms.flipped?(e.imageSize.height=n.naturalWidth,e.imageSize.width=n.naturalHeight):(e.imageSize.height=n.naturalHeight,e.imageSize.width=n.naturalWidth);var a=e.imageSize.width/e.imageSize.height;e.imageSize.height>e.imageSize.width?(r.style.height="".concat(e.imageSize.height,"px"),r.style.width="".concat(r.clientHeight*a,"px"),r.clientWidth/r.clientHeight!=a&&(r.style.height="".concat(r.clientWidth/a,"px"))):(r.style.width="".concat(e.imageSize.width,"px"),r.style.height="".concat(r.clientWidth/a,"px"),r.clientHeight/r.clientWidth!=a&&(r.style.width="".concat(r.clientHeight*a,"px"))),s["a"].nextTick((function(){var i=bi(e.areaSize,"areaSize",(function(e){return[e.cropper,e.image,e.imageWidth,e.imageHeight]}))({cropper:o,image:n,imageWidth:e.imageSize.width,imageHeight:e.imageSize.height}),s=i.height,r=i.width;s&&(e.boundarySize.height=s),r&&(e.boundarySize.width=r),t()}))}else i()}))},getAllowedArea:function(e){return this.allowedArea({breakBoundaries:e,imageSize:this.imageSize,worldTransforms:this.worldTransforms,imageRestriction:this.imageRestriction})},stencilAspectRatios:function(){return this.$refs.stencil.aspectRatios?this.$refs.stencil.aspectRatios():{minimum:this.stencilProps.aspectRatio||this.stencilProps.minAspectRatio,maximum:this.stencilProps.aspectRatio||this.stencilProps.maxAspectRatio}}}},xi=yi,_i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"cropper",class:e.classes.cropper},[i("div",{class:e.classes.background,style:e.areaStyle}),e._v(" "),i("div",{ref:"stretcher",class:e.classes.stretcher}),e._v(" "),i("div",{ref:"area",class:e.classes.area,style:e.areaStyle},[i("CropperWrapper",{class:e.classes.cropperWrapper,attrs:{"wheel-resize":e.settings.wheelResize,"touch-resize":e.settings.touchResize,"touch-move":e.settings.touchMove,"mouse-move":e.settings.touchMove},on:{move:e.onManipulateImage,resize:e.onManipulateImage}},[i("div",{class:e.classes.imageWrapper},[i("img",{ref:"image",class:e.classes.image,style:e.imageStyle,attrs:{crossOrigin:e.imageAttributes.crossOrigin,src:e.imageAttributes.src},on:{mousedown:function(e){e.preventDefault()}}})]),e._v(" "),i(e.stencilComponent,e._b({ref:"stencil",tag:"component",attrs:{img:{src:e.imageAttributes.src,size:e.imageSize,transforms:e.imageTransforms,coefficient:e.coefficient},"result-coordinates":e.coordinates,"stencil-coordinates":e.stencilCoordinates},on:{resize:e.onResize,move:e.onMove}},"component",e.stencilProps,!1)),e._v(" "),e.canvas?i("canvas",{ref:"canvas",style:{display:"none"}}):e._e(),e._v(" "),e.canvas?i("canvas",{ref:"sourceCanvas",style:{display:"none"}}):e._e()],1)],1)])},Si=[],zi=void 0,Ci=void 0,Ei=void 0,Ti=!1,Mi=B({render:_i,staticRenderFns:Si},zi,xi,Ci,Ti,Ei,void 0,void 0),Ri=w("vue-preview-image"),Wi={name:"PreviewImage",props:{img:{type:String},classname:{type:String},imageClassname:{type:String},width:{type:Number},height:{type:Number},top:{type:Number},left:{type:Number},previewWidth:{type:Number,required:!0},previewHeight:{type:Number,required:!0}},data:function(){return{imageSize:{width:0,height:0}}},computed:{classnames:function(){return{default:v(Ri(),this.classname),image:v(Ri("image"),this.imageClassname)}},wrapperStyle:function(){return{width:"".concat(this.previewWidth,"px"),height:"".concat(this.previewHeight,"px")}},imageStyle:function(){var e=this.previewHeight/this.height;return{width:"".concat(this.imageSize.width*e,"px"),height:"".concat(this.imageSize.height*e,"px"),left:"".concat(-this.left*e,"px"),top:"".concat(-this.top*e,"px")}}},watch:{img:function(){this.onChangeImage()}},mounted:function(){this.onChangeImage()},methods:{refreshImage:function(){var e=this.$refs.image;this.imageSize.height=e.naturalHeight,this.imageSize.width=e.naturalWidth},onChangeImage:function(){var e=this,t=this.$refs.image;t.complete?this.refreshImage():t.addEventListener("load",(function(){e.refreshImage()}))}}},$i=Wi,ki=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.classnames.default,style:e.wrapperStyle},[i("img",{ref:"image",class:e.classnames.image,style:e.imageStyle,attrs:{src:e.img}})])},Di=[],Ai=void 0,Hi=void 0,Oi=void 0,Bi=!1;B({render:ki,staticRenderFns:Di},Ai,$i,Hi,Bi,Oi,void 0,void 0);function Li(e,t){if(t&&"undefined"!==typeof document){for(var i,n=document.head||document.getElementsByTagName("head")[0],o=n.getElementsByTagName("style"),s=0;s<o.length;s++)o[s]&&o[s].innerText&&o[s].innerText.startsWith("/*for="+e)&&(i=o[s]);if(i||(i=document.createElement("style"),i.type="text/css",n.insertBefore(i,o[0]||n.firstChild)),i.styleSheet)i.styleSheet.cssText=t;else{var r=document.createTextNode("/*for="+e+"*/"+t);i.innerHTML="",i.appendChild(r)}}}s["a"].component("cropper",Mi),s["a"].component("rectangle-stencil",Ft),s["a"].component("circle-stencil",ti),s["a"].component("simple-handler",Ct),s["a"].component("simple-line",Ht),Li("vue-advanced-cropper",".vue-advanced-cropper{text-align:center;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;max-height:100%;max-width:100%;direction:ltr}.vue-advanced-cropper__stretcher{pointer-events:none;position:relative;max-width:100%;max-height:100%}.vue-advanced-cropper__image{opacity:.5;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:absolute;-webkit-transform-origin:center;transform-origin:center;max-width:unset!important}.vue-advanced-cropper__area{position:absolute;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);top:50%}.vue-advanced-cropper__background{position:absolute;background:#000;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.vue-advanced-cropper__cropper-wrapper{width:100%;height:100%}.vue-advanced-cropper__image-wrapper{overflow:hidden;position:absolute;width:100%;height:100%}.vue-advanced-cropper__stencil-wrapper{position:absolute}.vue-circle-stencil{position:absolute;height:100%;width:100%;-webkit-box-sizing:content-box;box-sizing:content-box;cursor:move}.vue-circle-stencil__preview{border-radius:50%}.vue-rectangle-stencil{position:absolute;height:100%;width:100%;-webkit-box-sizing:border-box;box-sizing:border-box}.vue-rectangle-stencil--movable{cursor:move}.vue-simple-line{background:0 0;-webkit-transition:border .5s;transition:border .5s;border-color:rgba(255,255,255,.3);border-width:0;border-style:solid}.vue-simple-line--north,.vue-simple-line--south{height:0;width:100%}.vue-simple-line--east,.vue-simple-line--west{height:100%;width:0}.vue-simple-line--east{border-right-width:1px}.vue-simple-line--west{border-left-width:1px}.vue-simple-line--south{border-top-width:1px}.vue-simple-line--north{border-bottom-width:1px}.vue-simple-line--hover{opacity:1;border-color:#fff}.vue-square-handler{display:block;background:#fff;height:10px;width:10px}.vue-preview-image{overflow:hidden;position:relative}.vue-preview-image__image{pointer-events:none;position:absolute;max-width:unset!important}.vue-line-wrapper{background:0 0;position:absolute;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.vue-line-wrapper--north,.vue-line-wrapper--south{height:12px;width:100%;left:0;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.vue-line-wrapper--north{top:0;cursor:n-resize}.vue-line-wrapper--south{top:100%;cursor:s-resize}.vue-line-wrapper--east,.vue-line-wrapper--west{width:12px;height:100%;-webkit-transform:translateX(-50%);transform:translateX(-50%);top:0}.vue-line-wrapper--east{left:100%;cursor:e-resize}.vue-line-wrapper--west{left:0;cursor:w-resize}.vue-line-wrapper--disabled{cursor:auto}.vue-bounding-box{position:relative;height:100%;width:100%}.vue-preview-result{overflow:hidden;-webkit-box-sizing:border-box;box-sizing:border-box;position:absolute;height:100%;width:100%}.vue-preview-result__wrapper{position:absolute}.vue-preview-result__image{pointer-events:none;position:absolute;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-transform-origin:center;transform-origin:center;max-width:unset!important}.vue-handler-wrapper{position:absolute;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.vue-handler-wrapper__draggable{width:30px;height:30px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.vue-handler-wrapper--west-north{left:0;top:0;cursor:nw-resize}.vue-handler-wrapper--north{left:50%;top:0;cursor:n-resize}.vue-handler-wrapper--east-north{left:100%;top:0;cursor:ne-resize}.vue-handler-wrapper--east{left:100%;top:50%;cursor:e-resize}.vue-handler-wrapper--east-south{left:100%;top:100%;cursor:se-resize}.vue-handler-wrapper--south{left:50%;top:100%;cursor:s-resize}.vue-handler-wrapper--west-south{left:0;top:100%;cursor:sw-resize}.vue-handler-wrapper--west{left:0;top:50%;cursor:w-resize}.vue-handler-wrapper--disabled{cursor:auto}.vue-draggable-area{position:relative}");var ji=i("56d7"),Pi={created(){ji["bus"].$on("file:"+this.field.name,e=>{this.begin_value=e,document.getElementById(this.field.name+"_attach").value="",this.imgSrc=""})},components:{Cropper:Mi},props:["form","field"],computed:{img_path(){if(/\.(jpg|png|svg|gif)/.test(this.begin_value)){let e=this.field.filedir+"/"+this.begin_value;return e.replace(/^\.\//,"/")}return""},is_img(){return/^.+\.(jpg|png|wepb|gif)$/i.test(this.begin_value)},download_link(){let e=this.field.filedir.replace(/^\./,"");return e+"/"+this.field.begin_value}},watch:{},data:function(){return{begin_value:"",show_loaded:!1,imgSrc:"",orig_name:"",cropImage:null,all_accept:!1,err_str:"",crops:[]}},mounted(){this.init(),this.field_error_check()},methods:{init(){let e=this.field;if(this.begin_value=e.begin_value,this.crops=[],e.resize)for(let t of e.resize){let e=t.size.split("x");this.crops.push({description:t.description||"",width:e[0],height:e[1],data:"",accept:0})}},field_error_check(){let e=this.field;if(!e.required||this.imgSrc||this.begin_value?e.crops&&(e.error=!!this.imgSrc,this.imgSrc&&this.crops.length>0&&(this.calc_all_accept(),e.error=!this.all_accept)):(this.err_str="Файл обязателен для загрузки",e.error=!0),e.max_size){let t=document.getElementById(this.field.name+"_attach").files[0];void 0!==t&&(parseInt(e.max_size)<parseInt(t.size)?(e.error=!0,this.err_str="размер загружаемого файла слишком велик"):this.err_str="")}e.error||(e.error=!1),e.value=this.get_value(),ji["bus"].$emit("change_field",e)},get_value(){let e=this.field;return this.imgSrc?e.crops?e.error||!this.orig_name?null:{orig_name:this.orig_name,src:this.imgSrc,crops:this.crops}:{orig_name:this.orig_name,src:this.imgSrc}:null},clear(){this.imgSrc="",this.field_error_check()},run_cropper(){let e=document.getElementById(this.field.name+"_attach").files[0];if(e){this.orig_name=e.name;let t=new FileReader;t.readAsDataURL(e),t.onload=e=>{this.imgSrc=e.target.result,this.field_error_check()}}else if(this.imgSrc="",this.crops)for(let t of this.crops)t.data="",t.accept=0;this.field_error_check(),this.get_value()},stencil_props(e){return{aspectRatio:parseInt(e.width)/parseInt(e.height)}},change(e){this.crops[e].accept=0,this.calc_all_accept(),this.field_error_check()},crop(e){this.crops[e].accept=1;const{coordinates:t,canvas:i}=this.$refs["c"+e][0].getResult();this.crops[e].data=i.toDataURL(),this.crops[e].accept=2,this.field_error_check(),this.calc_all_accept()},accept_all(){for(let e of this.crops)e.accept=2;this.all_accept=!0,this.field_error_check(),this.calc_all_accept()},calc_all_accept(){for(let e of this.crops)if(2!==e.accept)return this.all_accept=!1,!1;return this.all_accept=!0,!0},start_crop_already_loaded(){let e=this.field.filedir+"/"+this.begin_value;this.orig_name=this.begin_value,this.imgSrc=e.replace(/^\.\//,"/")},remove(){this.$http.post(this.BackendBase()+"//edit-form/"+this.form.config+"/"+this.form.id,{action:"delete_file",name:this.field.name}).then(e=>{let t=e.data;t.success&&(this.begin_value=""),this.errors=t.errors})},BackendBase(){return/^localhost:/.test(location.host)?"http://dev-crm.test/backend":"/backend"}}},Ii=Pi,Xi=(i("ea14"),i("2877")),Yi=i("6544"),Ni=i.n(Yi),Fi=i("b0af"),Ui=i("23a7"),Vi=i("0e8f"),qi=i("132d"),Gi=i("a722"),Zi=Object(Xi["a"])(Ii,n,o,!1,null,"2b573514",null);t["default"]=Zi.exports;Ni()(Zi,{VCard:Fi["a"],VFileInput:Ui["a"],VFlex:Vi["a"],VIcon:qi["a"],VLayout:Gi["a"]})},c122:function(e,t,i){},ea14:function(e,t,i){"use strict";var n=i("c122"),o=i.n(n);o.a}}]);
//# sourceMappingURL=chunk-3fde6341.501bc9dc.js.map