(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4cf437bf"],{"7fe1":function(e,t,i){},"8c2c":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e.errors.length?i("errors",{attrs:{errors:e.errors}}):e._e(),e.id?[e.loading?i("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}}):[i("v-card",{staticClass:"memo",class:{is_in_results:e.is_in_results}},[e.data.length?e._e():i("div",[e._v("\n              пусто\n            ")]),e._l(e.data,(function(t,s){return i("div",{key:t.idl},[t.edit_on?i("div",{staticClass:"edit_on"},[i("v-textarea",{attrs:{rows:1,label:"Измените комментарий:","auto-grow":!0,clearable:!0,autofocus:!0},model:{value:t.message,callback:function(i){e.$set(t,"message",i)},expression:"l.message"}}),i("v-btn",{attrs:{color:"primary",small:""},on:{click:function(i){return e.update(t)}}},[e._v("Внести изменения")]),i("v-btn",{attrs:{color:"red",small:""},on:{click:function(i){return e.edit(t,!1)}}},[e._v("Отмена")])],1):i("div",{staticClass:"memo_item"},[i("div",{staticClass:"date",style:t.style},[e._v(e._s(t.date))]),i("div",{staticClass:"user_name",style:t.style},[e._v(e._s(t.user_name)+":")]),i("div",{staticClass:"message",domProps:{innerHTML:e._s(e.to_html(t.message))}}),e.field.make_delete?i("v-icon",{attrs:{small:""},on:{click:function(i){return e.edit(t,!0)}}},[e._v("edit")]):e._e(),e.field.make_delete?i("v-icon",{attrs:{small:""},on:{click:function(i){return e.del(t,s)}}},[e._v("delete")]):e._e()],1)])}))],2),e.form.read_only||e.field.read_only?e._e():[e.view_adding_block?e._e():i("v-btn",{attrs:{color:"primary",small:""},on:{click:function(t){e.view_adding_block=1}}},[e._v("Новый комментарий")]),e.view_adding_block?i("div",{staticClass:"adding_block pt-1"},[i("v-textarea",{attrs:{rows:1,label:"Введите комментарий","auto-grow":!0,clearable:!0,autofocus:!0},model:{value:e.adding_value,callback:function(t){e.adding_value=t},expression:"adding_value"}}),i("v-btn",{attrs:{color:"primary",small:""},on:{click:function(t){return e.add()}}},[e._v("Сохранить")]),i("v-btn",{attrs:{color:"red",small:""},on:{click:function(t){e.view_adding_block=!1}}},[e._v("Отмена")])],1):e._e()]]]:[e._v("\n    добавлять комментарии будет возможно после создания основной карты\n  ")]],2)},a=[],r=(i("56d7"),{data:function(){return{loading:!1,adding_value:"",view_adding_block:!1,user_color:{},colors:["#009688","#673AB7","#9C27B0","#3F51B5","#607D8B","#1B5E20","#004D40"],data:[],errors:[],id:!1}},props:["form","field","form_id"],mounted(){this.form_id&&(this.id=this.form_id),this.form&&!this.id&&this.form.id&&(this.id=this.form.id),this.init()},computed:{},methods:{init(){this.id&&this.$http.get(BackendBase+"/memo/get/"+this.form.config+"/"+this.field.name+"/"+this.id).then(e=>{let t=e.data;this.data=t.data,t.field.description||(t.field.description=""),this.errors=t.errors,this.colored(),this.loading=!1}).catch(e=>{this.errors=["error get memo: "+e]})},is_in_results(){return!!this.form_id},colored(){let e={},t=0;for(let i of this.data){let s;null==i.user_id&&(i.user_id=-1,i.user_name="<не известно>"),e[i.user_id]||(e[i.user_id]=this.colors[t],t++),s=e[i.user_id],i.style={color:s}}},add(){this.$http.post(BackendBase+"/memo/add/"+this.form.config+"/"+this.field.name+"/"+this.id,{message:this.adding_value}).then(e=>{let t=e.data;if(t.success&&t.memo_id){let e={id:t.memo_id,message:this.adding_value,user_name:t.user_name,user_id:t.user_id,date:t.now};this.field.reverse?this.data.unshift(e):this.data.push(e),this.adding_value="",this.colored()}this.errors=t.errors,this.hide_timeout_errors()})},hide_timeout_errors(){setTimeout(()=>{this.errors=[]},1e3)},update(e){this.edit(e,!1),this.$http.post(BackendBase+"/memo/update/"+this.form.config+"/"+this.field.name+"/"+this.id+"/"+e.id,{message:e.message}).then(t=>{let i=t.data;i.success&&(e.date=i.now,e.user_name=i.user_name,e.user_id=i.user_id,this.colored())})},edit(e,t){var i=[];e.edit_on=t;for(let s of this.data)i.push(s);this.data=i},del(e,t){this.$http.get(BackendBase+"/memo/delete/"+this.form.config+"/"+this.field.name+"/"+this.id+"/"+e.id).then(e=>{let i=e.data;i.success&&(this.data.splice(t,1),this.colored())})},to_html(e){return e?(e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/\n/g,"<br>"),e):""}},watch:{form_id(){this.id!=this.form_id&&(this.id=this.form_id,this.init())}}}),d=r,o=(i("d2cb"),i("2877")),n=i("6544"),l=i.n(n),c=i("8336"),_=i("b0af"),u=i("132d"),m=i("490a"),h=i("a844"),f=Object(o["a"])(d,s,a,!1,null,"72b2e823",null);t["default"]=f.exports;l()(f,{VBtn:c["a"],VCard:_["a"],VIcon:u["a"],VProgressCircular:m["a"],VTextarea:h["a"]})},d2cb:function(e,t,i){"use strict";var s=i("7fe1"),a=i.n(s);a.a}}]);
//# sourceMappingURL=chunk-4cf437bf.b460d574.js.map