(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7e399eb9"],{"17bc":function(t,e,r){"use strict";r.r(e);var s=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-app",[r("v-container",{attrs:{fluid:""}},[r("h1",{staticClass:"title"},[t._v(t._s(t.form.title))]),t._e(),t.fatal_errors.length?r("div",{staticClass:"errors"},t._l(t.fatal_errors,(function(e){return r("div",{key:e},[t._v(t._s(e))])})),0):[t.errors.length?r("div",{staticClass:"errors"},t._l(t.errors,(function(e){return r("div",{key:e},[t._v(t._s(e))])})),0):t._e(),r("div",[r("branch",{attrs:{level:1,form:t.form,add:t.add,del:t.del,move_end:t.move_end,list:t.list,parent:{id:0},watch_parent:t.watch_parent,add_to_map:t.add_to_map,new_runner:t.new_runner}})],1)]],2)],1)},i=[],a=r("70d5"),o=a["a"],d=(r("606e"),r("2877")),n=r("6544"),l=r.n(n),c=r("7496"),_=r("a523"),h=Object(d["a"])(o,s,i,!1,null,"900c79ee",null);e["default"]=h.exports;l()(h,{VApp:c["a"],VContainer:_["a"]})},"606e":function(t,e,r){"use strict";var s=r("d987"),i=r.n(s);i.a},"70d5":function(module,__webpack_exports__,__webpack_require__){"use strict";var _AdminTree_branch_vue__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("7d94");__webpack_exports__["a"]={props:["params"],components:{branch:_AdminTree_branch_vue__WEBPACK_IMPORTED_MODULE_0__["a"]},data(){return{form:{},list:[],map:{},parents:{},need_watch:0,fatal_errors:[],errors:[],watch_parent:"",new_runner:0}},created(){},watch:{params(){this.init()}},mounted(){this.init()},computed:{},methods:{init(){this.$http.get(BackendBase+"/admin-tree/"+this.params.config).then(response=>{var D=response.data;if(D.success){this.list=D.tree,this.form=D.form;for(let t of this.list)this.add_to_map(null,t);document.title=this.form.title,D.javascript&&eval(D.javascript)}else this.form.title="Ошибка!",this.fatal_errors=D.errors}).catch(t=>{alert(t)})},add(t,e){t?this.map[t]&&this.map[t].childs.push(e):this.list.push(e),this.map[e.id]=e,this.parents[e.id]=t},del(t,e){this.$http({method:"post",url:BackendBase+"/admin-tree/"+this.form.config,data:{config:this.form.config,action:"delete_branch",id:e.id}}).then(r=>{let s=r.data;if(console.log("success: ",s.success),s.success){if(t){let r=[];for(let s of this.map[t].childs)s.id!=e.id&&r.push(s);this.map[t].childs=r}else{let t=[];for(let r of this.list)r.id!=e.id&&t.push(r);this.list=t}delete this.map[e.id],delete this.parents[e.id]}else alert(s.error)})},add_to_map(t,e){if(!(e.id in this.map)&&(this.map[e.id]=e,this.parents[e.id]=t,t&&t in this.map)){this.watch_parent=t;let r=this.map[t];"childs"in r||(r.childs=[],r.childs.push(e))}if(e.childs)for(let r of e.childs)this.add_to_map(e.id,r)},obj_sort_by_parent(t){t=parseInt(t);let e=[];e=t?this.map[t].childs:this.list;let r=1,s={};for(let i of e)s[i.id]=r++;return s},move_end(t){let e,r=t.from.getAttribute("id"),s=t.to.getAttribute("id"),i=t.item.getAttribute("id");console.log({from:r}),e=r.match(/p-([0-9]+)/),r=e[1],e=s.match(/p-([0-9]+)/),s=e[1],e=i.match(/li-([0-9]+)/),i=e[1],console.log({from:r,to:s,item:i,arr:e}),r==s?this.request_sort(r,this.obj_sort_by_parent(r)):this.$http.post(BackendBase+"/admin-tree/"+this.form.config,{action:"move",id:i,to:s}).then(t=>{let e=t.data;this.errors=e.errors,e.success&&(this.request_sort(r,this.obj_sort_by_parent(r)),this.request_sort(s,this.obj_sort_by_parent(s)))}).catch(t=>{this.errors=["Ошибка при перемещении объекта: "+t]})},request_sort(t,e){this.$http.post(BackendBase+"/admin-tree/"+this.form.config,{action:"sort",config:this.form.config,parent_id:t,obj_sort:e}).then(t=>{var e=t.data;this.errors=e.errors,e.success}).catch({function(t){alert(t)}})}}}},"7d94":function(t,e,r){"use strict";var s=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("v-dialog",{attrs:{"max-width":"500"},model:{value:t.dialog_add_form,callback:function(e){t.dialog_add_form=e},expression:"dialog_add_form"}},[r("v-card",[r("v-card-title",{staticClass:"headline"},[t._v("Создание нового элемента")]),r("v-card-text",[r("v-text-field",{ref:"new_header"+t.parent.id,attrs:{label:"Наименование раздела"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.save()}},model:{value:t.values[t.form.header_field],callback:function(e){t.$set(t.values,t.form.header_field,e)},expression:"values[form.header_field]"}})],1),r("v-card-actions",[r("div",{staticClass:"flex-grow-1"}),r("v-btn",{attrs:{color:"red",text:""},on:{click:function(e){t.dialog_add_form=!1}}},[t._v("Отменить")]),r("v-btn",{attrs:{color:"primary darken-1",text:""},on:{click:function(e){return t.save()}}},[t._v("Сохранить")])],1)],1)],1),r("v-dialog",{attrs:{"max-width":"500"},model:{value:t.show_errors,callback:function(e){t.show_errors=e},expression:"show_errors"}},[r("v-card",[r("v-card-title",{staticClass:"headline"},[t._v("Произошли ошибки")]),r("v-card-text",[r("errors",{attrs:{errors:t.errors}})],1),r("v-card-actions",[r("div",{staticClass:"flex-grow-1"}),r("v-btn",{attrs:{color:"red",text:""},on:{click:function(e){t.show_errors=!1}}},[t._v("Закрыть")])],1)],1)],1),r("div",{staticClass:"Area"},[t.make_add?r("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.open_dialog_add_form(e)}}},[t._v("добавить\n            "),t.parent.id?r("span",[t._v(' в "'+t._s(t.parent.header)+'" ')]):r("span",[t._v(" в /")])]):t._e(),t.form.sort?r("div",[t.list.length?r("draggable",{staticClass:"list-group",attrs:{id:"p-"+t.parent.id,tag:"ul",list:t.list,"ghost-class":"ghost",options:{group:"g"+t.parent.id}},on:{start:t.move_start,end:t.move_end}},t._l(t.list,(function(e){return r("li",{key:e.id,attrs:{id:"li-"+e.id}},[r("div",[r("div",{staticClass:"li_header",style:{background:t.cur_color}},[t.form.tree_use?r("div",{staticClass:"plus-icon "},[!t.shows[e.id]&&t.form.tree_use?r("v-icon",{attrs:{small:"",color:"primary"},on:{click:function(r){return t.show_this(e)}}},[t._v("fa fa-plus")]):t._e(),t.shows[e.id]?r("v-icon",{attrs:{small:"",color:"primary"},on:{click:function(r){t.shows[e.id]=!1}}},[t._v("fa fa-minus")]):t._e()],1):t._e(),r("div",{staticClass:"branch-header"},[t._v("\n                            "+t._s(e.header)+" \n                            "),e.childs&&t.form.tree_use?[t._v("("+t._s(e.childs.length)+")")]:t._e()],2),r("div",{staticClass:"branch-tools ",staticStyle:{display:"block",position:"relative",top:"-30px",height:"0","margin-bottom":"0","text-align":"right"}},[r("a",{attrs:{href:"/edit_form/"+t.form.config+"/"+e.id},on:{click:function(r){return r.preventDefault(),t.go_to_edit(e.id)}}},[r("v-icon",{attrs:{color:"primary",small:""}},[t._v("edit")])],1),t._v(" \n                            "),t.make_delete(t.parent.id,e)?r("v-icon",{staticStyle:{"font-size":"10pt"},attrs:{small:"",color:"primary"},on:{click:function(r){return t.del(t.parent.id,e)}}},[t._v("fa fa-trash")]):t._e()],1)]),t.shows[e.id]?[e.childs?r("nested-draggable",{attrs:{form:t.form,level:t.level+1,list:e.childs,add_to_map:t.add_to_map,parent:e,add:t.add,del:t.del,move_end:t.move_end}}):t._e()]:t._e()],2)])})),0):t._e()],1):[t.list.length?r("ul",t._l(t.list,(function(e){return r("li",{key:e.id,attrs:{id:"li-"+e.id}},[r("div",{staticClass:"li_header"},[r("div",{staticClass:"ws-nowrap"},[t.form.tree_use?r("div",{staticClass:"plus-icon float-left"},[!t.shows[e.id]&&t.form.tree_use?r("v-icon",{attrs:{small:"",color:"primary"},on:{click:function(r){return t.show_this(e)}}},[t._v("fa fa-plus")]):t._e(),t.shows[e.id]?r("v-icon",{attrs:{small:"",color:"primary"},on:{click:function(r){t.shows[e.id]=!1}}},[t._v("fa fa-minus")]):t._e()],1):t._e(),r("div",{staticClass:"branch-header"},[t._v("\n                            "+t._s(e.header)+"\n                            "),e.childs&&t.form.tree_use?[t._v("("+t._s(e.childs.length)+")")]:t._e()],2),r("div",{staticClass:"branch-tools float-right"},[r("a",{attrs:{href:"/edit_form/"+t.form.config+"/"+e.id},on:{click:function(r){return r.preventDefault(),t.go_to_edit(e.id)}}},[r("v-icon",{attrs:{color:"primary",small:""}},[t._v("edit")])],1),t._v(" \n                            "),t.make_delete(t.parent.id,e)?r("v-icon",{staticStyle:{"font-size":"10pt"},attrs:{small:"",color:"primary"},on:{click:function(r){return t.del(t.parent.id,e)}}},[t._v("fa fa-trash")]):t._e()],1)])]),t.shows[e.id]?[e.childs?r("nested-draggable",{attrs:{form:t.form,level:t.level+1,list:e.childs,add_to_map:t.add_to_map,parent:e,add:t.add,del:t.del,move_end:t.move_end}}):t._e()]:t._e()],2)})),0):t._e()],t.exist_childs?t._e():r("div",{staticClass:"li_empty"},[t._v("\n        [ пусто ]\n    ")])],2)],1)},i=[],a={props:{list:{type:Array,required:!1},form:{type:Object,required:!1},level:{type:Number,required:!1},parent:{required:!0},add:{required:!0},del:{required:!0},move_end:{required:!0},add_to_map:{required:!0},new_runner:{type:Number,required:!1}},data(){return{dialog_add_form:!1,values:{},errors:[],show_errors:!1,shows:{0:!1}}},methods:{make_delete(t,e){return!this.form.read_only&&this.form.make_delete},make_open_childs(t){return!this.shows[t.id]&&this.tree_use},show_this(t){let e={};for(let r in this.shows)e[r]=this.shows[r];if(this.shows[t.id]=!0,this.form.tree_use&&!t.childs)this.$http.post(BackendBase+"/admin-tree/"+this.form.config,{action:"get_branch",parent_id:t.id}).then(r=>{let s=r.data;if(s.success){t.childs=s.data;for(let e of t.childs)this.add_to_map(this.parent.id,e);e[t.id]=!0,this.shows=e}}).catch((function(){alert("server error!")}));else{if(this.form.tree_use){let e=!1,r=[];for(let s of t.childs)"childs"in s||(r.push(s.id),e=!0);this.$http.post(BackendBase+"/admin-tree/"+this.form.config,{action:"load_many_childs",list:r}).then(t=>{let e=t.data;if(e.success)for(let r in e.data)for(let t of e.data[r])this.add_to_map(r,t)})}e[t.id]=!0,this.shows=e}},save(t){this.$http.post(BackendBase+"/admin-tree/"+this.form.config,{action:"add_branch_plain",parent_id:this.parent.id,header:this.values[this.form.header_field]}).then(t=>{let e=t.data;e.success?(this.add(this.parent.id,e.data),this.values={}):(this.show_errors=!0,this.errors=e.errors),this.dialog_add_form=!1})},go_to_edit(t){let e="";e=this.form.card_format&&"old"==this.form.card_format?"/edit_form.pl?config="+config+"&action=edit&id="+t:"/edit_form/"+this.form.config+"/"+t,window.open(e)},open_dialog_add_form(t){this.dialog_add_form=!0,t=t||this.parent.id,console.log({parent:this.parent.id}),setTimeout(()=>{this.parent.id&&this.$refs["new_header"+this.parent.id]?this.$refs["new_header"+this.parent.id].$refs.input.focus():console.log("not refs: new_header"+this.parent.id)},100)},move_start(){}},computed:{cur_color(){let t=["#CFD8DC","#D7CCC8","#FFCCBC","#FFE0B2","#FFECB3","#FFF9C4","#F0F4C3","#DCEDC8","#C8E6C9","#B2DFDB","#B2EBF2","#B3E5FC","#BBDEFB","#C5CAE9"];return this.level in t?t[this.level]:"#ffffff"},exist_childs(){return this.list&&this.list.length>0},make_add(){return!this.form.not_create&&(!this.form.max_level||parseInt(this.form.max_level)>=parseInt(this.level))}},mounted(){},watch:{new_runner(){this.new_runner&&(this.dialog_add_form=!0)}},name:"nested-draggable"},o=a,d=(r("d9f0"),r("2877")),n=r("6544"),l=r.n(n),c=r("8336"),_=r("b0af"),h=r("99d9"),f=r("169a"),m=r("132d"),p=r("8654"),u=Object(d["a"])(o,s,i,!1,null,"b77821f6",null);e["a"]=u.exports;l()(u,{VBtn:c["a"],VCard:_["a"],VCardActions:h["a"],VCardText:h["b"],VCardTitle:h["c"],VDialog:f["a"],VIcon:m["a"],VTextField:p["a"]})},a523:function(t,e,r){"use strict";r("20f6"),r("4b85");var s=r("e8f2"),i=r("d9f7");e["a"]=Object(s["a"])("container").extend({name:"v-container",functional:!0,props:{id:String,tag:{type:String,default:"div"},fluid:{type:Boolean,default:!1}},render(t,{props:e,data:r,children:s}){let a;const{attrs:o}=r;return o&&(r.attrs={},a=Object.keys(o).filter(t=>{if("slot"===t)return!1;const e=o[t];return t.startsWith("data-")?(r.attrs[t]=e,!1):e||"string"===typeof e})),e.id&&(r.domProps=r.domProps||{},r.domProps.id=e.id),t(e.tag,Object(i["a"])(r,{staticClass:"container",class:Array({"container--fluid":e.fluid}).concat(a||[])}),s)}})},d987:function(t,e,r){},d9f0:function(t,e,r){"use strict";var s=r("dda9"),i=r.n(s);i.a},dda9:function(t,e,r){}}]);
//# sourceMappingURL=chunk-7e399eb9.88bbefc2.js.map